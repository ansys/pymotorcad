
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Force export for Ansys Motion &#8212; pymotorcad-core</title>
  
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/css\ansys_sphinx_theme.css?v=0909a4fa" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://www.nerdfonts.com/assets/css/webfont.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=40c929c4" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />


  <!-- Include desired assets -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  

  
    <link href="../../_static/css/breadcrumbs.css" rel="stylesheet" />
  
    <script src="../../_static/documentation_options.js?v=61be957a"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'samples/general/MotionForceExport';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://motorcad.docs.pyansys.com/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../../_static/ansys-favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Simple parametric sweep for SYNC machine" href="ParameterSweepSync.html" />
    <link rel="prev" title="Stress sampling example" href="BridgeStressSampling.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.9.dev0" />
  <link rel="canonical" href="https://motorcad.docs.pyansys.com/version/stable/samples/general/MotionForceExport.html" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/pyansys_logo_transparent_black.png" class="logo__image only-light" alt="pymotorcad-core - Home"/>
    <img src="../../_static/pyansys_logo_transparent_white.png" class="logo__image only-dark pst-js-only" alt="pymotorcad-core - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user_guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../methods/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Example scripts repository
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../contributing.html">
    Contribute
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<div class="search-bar pst-js-only" id="search-bar">
  <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input type="search" class="form-control" name="q" placeholder="Search the docs ..."
      aria-label="Search the docs ..." autocomplete="off" autocorrect="off"
      autocapitalize="off" spellcheck="false" />
    <span class="search-button__kbd-shortcut">
      <kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd>
    </span>
  </form>
  <div id="static-search-results" class="static-search-results" style="display:none;" tabindex="0"></div>
</div>
        </div>
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pymotorcad" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pymotorcad/discussions" title="Support" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa fa-comment fa-fw fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Support</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<div class="search-bar pst-js-only" id="search-bar">
  <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input type="search" class="form-control" name="q" placeholder="Search the docs ..."
      aria-label="Search the docs ..." autocomplete="off" autocorrect="off"
      autocapitalize="off" spellcheck="false" />
    <span class="search-button__kbd-shortcut">
      <kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd>
    </span>
  </form>
  <div id="static-search-results" class="static-search-results" style="display:none;" tabindex="0"></div>
</div>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  
  
    <div id="announcement_msg"></div>
<script>
  fetch("announcement.html")
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error: ${response.status}`);
      }
      return response.text();
    })
    .then(
      (text) => (document.getElementById("announcement_msg").innerHTML = text),
    )
    .catch((error) => console.error(`Fetch problem: ${error.message}`));
</script>
  


  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user_guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../methods/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Example scripts repository
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../contributing.html">
    Contribute
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pymotorcad" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pymotorcad/discussions" title="Support" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa fa-comment fa-fw fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Support</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../adaptive_template/index.html">Adaptive template repository</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">General example repository</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="BridgeStressSampling.html">Stress sampling example</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Force export for Ansys Motion</a></li>
<li class="toctree-l2"><a class="reference internal" href="ParameterSweepSync.html">Simple parametric sweep for SYNC machine</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">
<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
         
    <li class="breadcrumb-item breadcrumb-home">
      <a href="https://docs.pyansys.com/" class="nav-link">PyAnsys</a>
    </li>
     
    <li class="breadcrumb-item">
      <a
        href="../../index.html"
        class="nav-link"
        aria-label="Home"
      >
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
     
    <li class="breadcrumb-item">
      <a href="../index.html" class="nav-link">Example scripts repository</a>
    </li>
     
    <li class="breadcrumb-item">
      <a href="index.html" class="nav-link">General example repository</a>
    </li>
      
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Force export for Ansys Motion</span></li>
    
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-samples-general-motionforceexport-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="force-export-for-ansys-motion">
<span id="sphx-glr-samples-general-motionforceexport-py"></span><h1>Force export for Ansys Motion<a class="headerlink" href="#force-export-for-ansys-motion" title="Link to this heading">#</a></h1>
<p>This example shows how to export forces for Ansys Motion multibody analysis software, and includes
more options for controlling the offset required to align the forces with the structural model.
The file names and offset parameters are set in the main script near the end of this file.</p>
<p>This script should be run from the scripting tab after the force calculation
has been run in Motor-CAD.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">ansys.motorcad.core</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pymotorcad</span>
</pre></div>
</div>
<section id="utility-functions-for-export">
<h2>Utility functions for export:<a class="headerlink" href="#utility-functions-for-export" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">write_name_value_pair</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">indent_level</span><span class="p">,</span> <span class="n">quoted_value</span><span class="p">,</span> <span class="n">comma_end</span><span class="p">):</span>
    <span class="c1"># Name</span>
    <span class="n">line_string</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
    <span class="c1"># Colon as a delimiter before value</span>
    <span class="n">line_string</span> <span class="o">=</span> <span class="n">line_string</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span>
    <span class="c1"># Value, in quotes as required</span>
    <span class="k">if</span> <span class="n">quoted_value</span><span class="p">:</span>
        <span class="n">line_string</span> <span class="o">=</span> <span class="n">line_string</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_string</span> <span class="o">=</span> <span class="n">line_string</span> <span class="o">+</span> <span class="n">value</span>
    <span class="c1"># Pad with 4 spaces per indent level</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">indent_level</span> <span class="o">*</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">line_string</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">line_string</span>
    <span class="k">if</span> <span class="n">comma_end</span><span class="p">:</span>
        <span class="n">line_string</span> <span class="o">=</span> <span class="n">line_string</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
    <span class="c1"># Write output line</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_string</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">unv_float_str</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">formatted_output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># Always use &#39;.&#39; as a decimal separator</span>
    <span class="k">return</span> <span class="n">formatted_output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">unv_float_long_str</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">formatted_output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">25.16e</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># Always use &#39;.&#39; as a decimal separator</span>
    <span class="k">return</span> <span class="n">formatted_output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">unv_float_short_str</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">formatted_output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">13.5e</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># Always use &#39;.&#39; as a decimal separator</span>
    <span class="k">return</span> <span class="n">formatted_output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">int_str_fixed_length_10</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">10d</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">int_str_fixed_length_6</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">6d</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">write_motion_load_point_definition</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">load_point_loop</span><span class="p">,</span> <span class="n">num_duplications</span><span class="p">):</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_array_variable</span><span class="p">(</span><span class="s2">&quot;LoadPoint_Speed_Array&quot;</span><span class="p">,</span> <span class="n">load_point_loop</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;loadPointDefinition : {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">write_name_value_pair</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;speedPoint&quot;</span><span class="p">,</span> <span class="n">unv_float_str</span><span class="p">(</span><span class="n">speed</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">write_name_value_pair</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;speedUnit&quot;</span><span class="p">,</span> <span class="s2">&quot;rpm&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">write_name_value_pair</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;symmetryMultiplier&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_duplications</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_electrical_periods_per_revolution</span><span class="p">(</span><span class="n">mc</span><span class="p">):</span>
    <span class="c1"># Handles SRM and BPM. Does not handle PMDC. For IM, this is per synchronous rotation</span>
    <span class="n">poles</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Pole_Number&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Motor_Type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># SRM</span>
        <span class="k">return</span> <span class="n">poles</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Others</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">poles</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_number_force_cycles</span><span class="p">(</span><span class="n">mc</span><span class="p">):</span>
    <span class="c1"># How many cycles have been run</span>
    <span class="k">if</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Motor_Type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># IM</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Variable was renamed in 2024R1, try newer naming first</span>
            <span class="n">electrical_cycles</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;IMSingleLoadNumberCycles_Rotating&quot;</span><span class="p">)</span>
        <span class="k">except</span> <a href="https://docs.python.org/dev/library/exceptions.html#Exception" title="builtins.Exception" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-exception"><span class="n">pymotorcad</span><span class="o">.</span><span class="n">MotorCADError</span></a><span class="p">:</span>
            <span class="n">electrical_cycles</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;IMSingleLoadNumberCycles&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">electrical_cycles</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;TorqueNumberCycles&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">electrical_cycles</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_num_duplications</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">elec_cycles_per_mechanical</span><span class="p">):</span>
    <span class="n">elec_cycles_run</span> <span class="o">=</span> <span class="n">get_number_force_cycles</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">elec_cycles_run</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elec_cycles_run</span> <span class="o">==</span> <span class="n">elec_cycles_per_mechanical</span><span class="p">:</span>
            <span class="c1"># No duplication needed, one mechanical cycle run</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">elec_cycles_run</span> <span class="o">%</span> <span class="n">elec_cycles_per_mechanical</span><span class="p">:</span>
            <span class="c1"># No duplication needed, an integer number of mechanical cycles run</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Non-integer number of mechanical cycles run, duplication needed</span>
            <span class="k">return</span> <span class="n">elec_cycles_per_mechanical</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># One cycle run, duplication needed</span>
        <span class="k">return</span> <span class="n">elec_cycles_per_mechanical</span>


<span class="k">def</span><span class="w"> </span><span class="nf">write_unv_general_header</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="c1"># Header file data set is 151</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   151</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># model file name:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;transient node force from Motor-CAD 2D solver</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># model file description (or NONE)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;NONE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># program used</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;PyMotorCAD Script</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># date and time information (or NONE)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;NONE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">write_unv_units_header</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   164</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># 1 = SI, followed by description, then 2 = Relative temperature mode</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  1 SI - mks (Newton/m)  2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Unit factors to convert to SI units (length, force, temp, temp offset)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  1.00000e+00  1.00000e+00  1.00000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  0.00000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">mechanical_node_positions</span><span class="p">(</span>
    <span class="n">node_number</span><span class="p">,</span>
    <span class="n">number_of_nodes</span><span class="p">,</span>
    <span class="n">stator_bore_radius</span><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">offset_angle_degrees</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_x</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_y</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_z</span></a><span class="p">,</span>
<span class="p">):</span>
    <span class="n">node_angle</span> <span class="o">=</span> <span class="n">node_number</span> <span class="o">/</span> <span class="n">number_of_nodes</span> <span class="o">*</span> <span class="mi">360</span> <span class="o">-</span> <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">offset_angle_degrees</span></a>
    <span class="n">sin_angle</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/math.html#math.sin" title="math.sin" class="sphx-glr-backref-module-math sphx-glr-backref-type-py-function"><span class="n">math</span><span class="o">.</span><span class="n">sin</span></a><span class="p">(</span><a href="https://docs.python.org/dev/library/math.html#math.radians" title="math.radians" class="sphx-glr-backref-module-math sphx-glr-backref-type-py-function"><span class="n">math</span><span class="o">.</span><span class="n">radians</span></a><span class="p">(</span><span class="n">node_angle</span><span class="p">))</span>
    <span class="n">cos_angle</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/math.html#math.cos" title="math.cos" class="sphx-glr-backref-module-math sphx-glr-backref-type-py-function"><span class="n">math</span><span class="o">.</span><span class="n">cos</span></a><span class="p">(</span><a href="https://docs.python.org/dev/library/math.html#math.radians" title="math.radians" class="sphx-glr-backref-module-math sphx-glr-backref-type-py-function"><span class="n">math</span><span class="o">.</span><span class="n">radians</span></a><span class="p">(</span><span class="n">node_angle</span><span class="p">))</span>
    <span class="n">node_x</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_x</span></a> <span class="o">+</span> <span class="n">stator_bore_radius</span> <span class="o">*</span> <span class="n">cos_angle</span>
    <span class="n">node_y</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_y</span></a> <span class="o">-</span> <span class="n">stator_bore_radius</span> <span class="o">*</span> <span class="n">sin_angle</span>
    <span class="n">node_z</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_z</span></a>
    <span class="k">return</span> <span class="p">[</span><span class="n">node_x</span><span class="p">,</span> <span class="n">node_y</span><span class="p">,</span> <span class="n">node_z</span><span class="p">,</span> <span class="n">cos_angle</span><span class="p">,</span> <span class="n">sin_angle</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_mesh_node_id</span><span class="p">(</span><span class="n">position_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="n">is_stator</span><span class="p">,</span> <span class="n">is_main_node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find internal &#39;dummy fea&#39; mesh ID for position on stator or rotor.</span>
<span class="sd">    Mod operation is applied to position ID, so we can &#39;loop&#39; around machine.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">is_stator</span><span class="p">:</span>
        <span class="n">internal_position_id</span> <span class="o">=</span> <span class="n">position_id</span> <span class="o">%</span> <span class="n">num_nodes_stator</span>
        <span class="n">start_node</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">internal_position_id</span> <span class="o">=</span> <span class="n">position_id</span> <span class="o">%</span> <span class="n">num_nodes_rotor</span>
        <span class="n">start_node</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_nodes_stator</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Main node IDs are 0, 2, 4, ... + offset</span>
    <span class="c1"># Secondary node IDs are 1, 3, 5, ... + offset</span>
    <span class="k">if</span> <span class="n">is_main_node</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">start_node</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">internal_position_id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">start_node</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">internal_position_id</span> <span class="o">+</span> <span class="mi">1</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_timestep_delta</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">load_point</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">):</span>
    <span class="n">rpm</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_array_variable</span><span class="p">(</span><span class="s2">&quot;LoadPoint_Speed_Array&quot;</span><span class="p">,</span> <span class="n">load_point</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Motor_Type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">slip</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_array_variable</span><span class="p">(</span><span class="s2">&quot;LoadPoint_Slip_Array&quot;</span><span class="p">,</span> <span class="n">load_point</span><span class="p">)</span>
        <span class="n">syncronous_rpm</span> <span class="o">=</span> <span class="n">rpm</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">slip</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">syncronous_rpm</span> <span class="o">=</span> <span class="n">rpm</span>
    <span class="n">rotational_frequency</span> <span class="o">=</span> <span class="n">syncronous_rpm</span> <span class="o">/</span> <span class="mi">60</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rotational_frequency</span> <span class="o">/</span> <span class="n">num_steps</span>


<span class="k">def</span><span class="w"> </span><span class="nf">duplicate_magnetic_3d_data</span><span class="p">(</span><span class="n">magnetic_3d_data</span><span class="p">,</span> <span class="n">num_duplications</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">num_duplications</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">magnetic_3d_data</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Don&#39;t need to do anything, or can&#39;t</span>
        <span class="k">return</span> <span class="n">magnetic_3d_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Duplicate. Y is electrical angle, and last point is a duplicate of the first</span>
        <span class="n">original_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">magnetic_3d_data</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># Output also needs duplicated final point for consistency</span>
        <span class="n">final_length</span> <span class="o">=</span> <span class="n">original_length</span> <span class="o">*</span> <span class="n">num_duplications</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># Number of points also has a duplicate at end, but as we&#39;re just</span>
        <span class="c1"># duplicating in time, we can treat the last point like any other one</span>
        <span class="n">num_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">magnetic_3d_data</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># Duplicate time information</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">angle_start</span> <span class="o">=</span> <span class="n">magnetic_3d_data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">angle_step</span> <span class="o">=</span> <span class="n">magnetic_3d_data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">magnetic_3d_data</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">time_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">final_length</span><span class="p">):</span>
            <span class="n">new_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle_start</span> <span class="o">+</span> <span class="n">time_index</span> <span class="o">*</span> <span class="n">angle_step</span><span class="p">)</span>

        <span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">point_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
            <span class="n">new_data_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">time_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">final_length</span><span class="p">):</span>
                <span class="n">lookup_index</span> <span class="o">=</span> <span class="n">time_index</span> <span class="o">%</span> <span class="n">original_length</span>
                <span class="n">new_data_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">magnetic_3d_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">point_index</span><span class="p">][</span><span class="n">lookup_index</span><span class="p">])</span>
            <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data_values</span><span class="p">)</span>

        <span class="c1"># Replace original y and data with new</span>
        <span class="n">magnetic_3d_data</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">new_data</span>
        <span class="n">magnetic_3d_data</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">new_y</span>

        <span class="k">return</span> <span class="n">magnetic_3d_data</span>


<span class="k">def</span><span class="w"> </span><span class="nf">export_to_motion_unv</span><span class="p">(</span>
    <span class="n">mc</span><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">unv_filename</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">amesh_filename</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">anf_filename</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">offset_angle_degrees</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_x</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_y</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_z</span></a><span class="p">,</span>
<span class="p">):</span>
    <span class="n">num_load_points</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;numLoadPoints&quot;</span><span class="p">)</span>
    <span class="n">electrical_periods_per_revolution</span> <span class="o">=</span> <span class="n">get_electrical_periods_per_revolution</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span>
    <span class="n">num_duplications</span> <span class="o">=</span> <span class="n">get_num_duplications</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">electrical_periods_per_revolution</span><span class="p">)</span>

    <span class="c1"># Create the UNV file</span>
    <span class="n">unv_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">unv_filename</span></a><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">unv_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;metaData : {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">write_name_value_pair</span><span class="p">(</span>
        <span class="n">unv_file</span><span class="p">,</span> <span class="s2">&quot;MaxwellSimulationType&quot;</span><span class="p">,</span> <span class="s2">&quot;2D, Element-based (Surface)&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">unv_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;},</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_load_points</span><span class="p">):</span>
        <span class="n">write_motion_load_point_definition</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">unv_file</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">num_duplications</span><span class="p">)</span>
    <span class="n">unv_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># Get the force data from Motor-CAD for stator and rotor, just to find number of nodes and steps</span>
    <span class="n">forces_stator_tangential_per_slice</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_magnetic_3d_graph</span><span class="p">(</span><span class="s2">&quot;Ft_Stator_OL_Lumped&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">forces_rotor_tangential_per_slice</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_magnetic_3d_graph</span><span class="p">(</span><span class="s2">&quot;Ft_Rotor_OL_Lumped&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Duplicate forces for a whole mechanical cycle if required</span>
    <span class="n">forces_stator_tangential_per_slice</span> <span class="o">=</span> <span class="n">duplicate_magnetic_3d_data</span><span class="p">(</span>
        <span class="n">forces_stator_tangential_per_slice</span><span class="p">,</span> <span class="n">num_duplications</span>
    <span class="p">)</span>
    <span class="n">forces_rotor_tangential_per_slice</span> <span class="o">=</span> <span class="n">duplicate_magnetic_3d_data</span><span class="p">(</span>
        <span class="n">forces_rotor_tangential_per_slice</span><span class="p">,</span> <span class="n">num_duplications</span>
    <span class="p">)</span>

    <span class="c1"># Check number of points and steps to output</span>
    <span class="n">num_nodes_stator</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">forces_stator_tangential_per_slice</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">num_nodes_rotor</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">forces_rotor_tangential_per_slice</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">num_steps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">forces_rotor_tangential_per_slice</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="c1"># Find stator and rotor radius.</span>
    <span class="c1"># This will not handle things like banding/sleeve so could be improved if needed</span>
    <span class="n">stator_bore_radius</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Stator_Bore&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">rotor_radius</span> <span class="o">=</span> <span class="n">stator_bore_radius</span> <span class="o">-</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Airgap&quot;</span><span class="p">)</span>
    <span class="c1"># Create the .amesh file</span>
    <span class="n">amesh_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">amesh_filename</span></a><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">write_unv_general_header</span><span class="p">(</span><span class="n">amesh_file</span><span class="p">)</span>
    <span class="n">write_unv_units_header</span><span class="p">(</span><span class="n">amesh_file</span><span class="p">)</span>
    <span class="c1"># Write nodal information (2411)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  2411</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Stator nodes</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Stator nodes:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">internal_node_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_nodes_stator</span><span class="p">):</span>
        <span class="n">node_x</span><span class="p">,</span> <span class="n">node_y</span><span class="p">,</span> <span class="n">node_z</span><span class="p">,</span> <span class="n">cos_angle</span><span class="p">,</span> <span class="n">sin_angle</span> <span class="o">=</span> <span class="n">mechanical_node_positions</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span>
            <span class="n">num_nodes_stator</span><span class="p">,</span>
            <span class="n">stator_bore_radius</span><span class="p">,</span>
            <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">offset_angle_degrees</span></a><span class="p">,</span>
            <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_x</span></a><span class="p">,</span>
            <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_y</span></a><span class="p">,</span>
            <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_z</span></a><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># For all node definitions, format is</span>
        <span class="c1"># Node ID, followed by export coordinate system, displacement coordinate system, colour,</span>
        <span class="c1"># position X position Y position Z</span>

        <span class="c1"># Main node</span>
        <span class="n">mesh_node_id</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;         1         1         1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_x</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_y</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_z</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Outer node</span>
        <span class="n">mesh_node_id</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;         1         1         1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_x</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_y</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_z</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Rotor nodes</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Rotor nodes:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">internal_node_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_nodes_rotor</span><span class="p">):</span>
        <span class="n">node_x</span><span class="p">,</span> <span class="n">node_y</span><span class="p">,</span> <span class="n">node_z</span><span class="p">,</span> <span class="n">cos_angle</span><span class="p">,</span> <span class="n">sin_angle</span> <span class="o">=</span> <span class="n">mechanical_node_positions</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span>
            <span class="n">num_nodes_rotor</span><span class="p">,</span>
            <span class="n">rotor_radius</span><span class="p">,</span>
            <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">offset_angle_degrees</span></a><span class="p">,</span>
            <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_x</span></a><span class="p">,</span>
            <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_y</span></a><span class="p">,</span>
            <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_z</span></a><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># For all node definitions, format is</span>
        <span class="c1"># Node ID, followed by export coordinate system, displacement coordinate system, colour,</span>
        <span class="c1"># position X position Y position Z</span>

        <span class="c1"># Main node</span>
        <span class="n">mesh_node_id</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;         1         1         1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_x</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_y</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_z</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Outer node</span>
        <span class="n">mesh_node_id</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;         1         1         1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_x</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_y</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">unv_float_long_str</span><span class="p">(</span><span class="n">node_z</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Element information (2412). There will be 2 triangular elements per force node</span>
    <span class="c1"># Track element ID</span>
    <span class="n">element_id</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  2412</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Stator connectivity matrix:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">internal_node_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_nodes_stator</span><span class="p">):</span>
        <span class="c1"># Element ID, FEA descriptor ID (61 for triangular), physical property table (0),</span>
        <span class="c1"># material property table (0), color (11), number of nodes (3)</span>

        <span class="c1"># First triangle</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;        61         0         0        11         3</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_1</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_2</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_3</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_2</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_3</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">element_id</span> <span class="o">=</span> <span class="n">element_id</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Second triangle</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;        61         0         0        11         3</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_1</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_2</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_3</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_2</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_3</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">element_id</span> <span class="o">=</span> <span class="n">element_id</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Rotor connectivity matrix:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">internal_node_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_nodes_rotor</span><span class="p">):</span>
        <span class="c1"># Element ID, FEA descriptor ID (61 for triangular), physical property table (0),</span>
        <span class="c1"># material property table (0), color (11), number of nodes (3)</span>

        <span class="c1"># First triangle</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;        61         0         0        11         3</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_1</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_2</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_3</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_2</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_3</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">element_id</span> <span class="o">=</span> <span class="n">element_id</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Second triangle</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;        61         0         0        11         3</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_1</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_2</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">mesh_node_id_3</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
            <span class="n">internal_node_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_2</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">int_str_fixed_length_10</span><span class="p">(</span><span class="n">mesh_node_id_3</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">element_id</span> <span class="o">=</span> <span class="n">element_id</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">amesh_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># Force file</span>
    <span class="k">if</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Motor_Type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># IM, don&#39;t include last duplicated point</span>
        <span class="n">num_output_steps</span> <span class="o">=</span> <span class="n">num_steps</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_output_steps</span> <span class="o">=</span> <span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">anf_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">anf_filename</span></a><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">slice_width</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Stator_Lam_Length&quot;</span><span class="p">),</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Rotor_Lam_Length&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_array_variable</span><span class="p">(</span><span class="s2">&quot;RotorSkewLengthProp_Array&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">slice_width</span> <span class="o">=</span> <span class="n">slice_width</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="k">for</span> <span class="n">load_point</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_load_points</span><span class="p">):</span>
        <span class="n">load_point_rpm</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_array_variable</span><span class="p">(</span><span class="s2">&quot;LoadPoint_Speed_Array&quot;</span><span class="p">,</span> <span class="n">load_point</span><span class="p">)</span>
        <span class="n">delta_time</span> <span class="o">=</span> <span class="n">get_timestep_delta</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">load_point</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">)</span>

        <span class="c1"># Get the force data for this operating point</span>
        <span class="n">forces_stator_tangential_per_slice</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_magnetic_3d_graph</span><span class="p">(</span>
            <span class="s2">&quot;Ft_Stator_OL_Lumped&quot;</span> <span class="o">+</span> <span class="s2">&quot;_Th&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">load_point</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">forces_stator_radial_per_slice</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_magnetic_3d_graph</span><span class="p">(</span>
            <span class="s2">&quot;Fr_Stator_OL_Lumped&quot;</span> <span class="o">+</span> <span class="s2">&quot;_Th&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">load_point</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">forces_rotor_tangential_per_slice</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_magnetic_3d_graph</span><span class="p">(</span>
            <span class="s2">&quot;Ft_Rotor_OL_Lumped&quot;</span> <span class="o">+</span> <span class="s2">&quot;_Th&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">load_point</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">forces_rotor_radial_per_slice</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_magnetic_3d_graph</span><span class="p">(</span>
            <span class="s2">&quot;Fr_Rotor_OL_Lumped&quot;</span> <span class="o">+</span> <span class="s2">&quot;_Th&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">load_point</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span>
        <span class="p">)</span>

        <span class="c1"># Duplicate forces for a whole mechanical cycle if required</span>
        <span class="n">forces_stator_tangential_per_slice</span> <span class="o">=</span> <span class="n">duplicate_magnetic_3d_data</span><span class="p">(</span>
            <span class="n">forces_stator_tangential_per_slice</span><span class="p">,</span> <span class="n">num_duplications</span>
        <span class="p">)</span>
        <span class="n">forces_stator_radial_per_slice</span> <span class="o">=</span> <span class="n">duplicate_magnetic_3d_data</span><span class="p">(</span>
            <span class="n">forces_stator_radial_per_slice</span><span class="p">,</span> <span class="n">num_duplications</span>
        <span class="p">)</span>
        <span class="n">forces_rotor_tangential_per_slice</span> <span class="o">=</span> <span class="n">duplicate_magnetic_3d_data</span><span class="p">(</span>
            <span class="n">forces_rotor_tangential_per_slice</span><span class="p">,</span> <span class="n">num_duplications</span>
        <span class="p">)</span>
        <span class="n">forces_rotor_radial_per_slice</span> <span class="o">=</span> <span class="n">duplicate_magnetic_3d_data</span><span class="p">(</span>
            <span class="n">forces_rotor_radial_per_slice</span><span class="p">,</span> <span class="n">num_duplications</span>
        <span class="p">)</span>

        <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;forceData</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">write_motion_load_point_definition</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">anf_file</span><span class="p">,</span> <span class="n">load_point</span><span class="p">,</span> <span class="n">num_duplications</span><span class="p">)</span>
        <span class="n">write_unv_general_header</span><span class="p">(</span><span class="n">anf_file</span><span class="p">)</span>
        <span class="n">write_unv_units_header</span><span class="p">(</span><span class="n">anf_file</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">this_step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_output_steps</span><span class="p">):</span>
            <span class="n">rotor_angle_deg</span> <span class="o">=</span> <span class="n">this_step</span> <span class="o">*</span> <span class="n">delta_time</span> <span class="o">*</span> <span class="p">(</span><span class="n">load_point_rpm</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span>

            <span class="c1"># Find step index to lookup data, Normally same as this_step,</span>
            <span class="c1"># except if looping for end point</span>
            <span class="k">if</span> <span class="n">this_step</span> <span class="o">==</span> <span class="n">num_steps</span><span class="p">:</span>
                <span class="n">step_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">step_index</span> <span class="o">=</span> <span class="n">this_step</span>

            <span class="c1"># Write nodal force information (2414)</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  2414</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Analysis dataset label</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;     1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Analysis dataset name</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Exported by Motor-CAD: Transient data: Force</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Dataset location, 1 is data at nodes</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;     1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># ID line 1</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;NONE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># ID line 2</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Data written by Motor-CAD</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># ID line 3</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;NONE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># ID line 4</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;time</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># ID line 5</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;NONE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Format information: 1=Structural, 4=Transient, 2=3DoF vector,</span>
            <span class="c1"># 9=Reaction Force, 2=Single precision float, 3=Number of values for the data</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;         1         4         2         9         2         3</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Integer analysis data (1-8), including timestep:</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;         0         0         1         0         0         0&quot;</span>
                <span class="o">+</span> <span class="n">int_str_fixed_length_10</span><span class="p">(</span>
                    <span class="n">this_step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;         0</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Integer analysis data  (9-10), not used:</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;         0         0         0         0         0         0         0         0</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Floating point data (1-6), including time for timestep:</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">unv_float_short_str</span><span class="p">(</span><span class="n">this_step</span> <span class="o">*</span> <span class="n">delta_time</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;  0.00000e+00  0.00000e+00  0.00000e+00  0.00000e+00  0.00000e+00</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Floating point data (7-12), not used:</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;- 0.00000e+00  0.00000e+00  0.00000e+00  0.00000e+00  0.00000e+00  0.00000e+00</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Nodal force information:</span>

            <span class="c1"># Stator</span>
            <span class="k">for</span> <span class="n">internal_node_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_nodes_stator</span><span class="p">):</span>
                <span class="n">mesh_node_id</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
                    <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">node_x</span><span class="p">,</span> <span class="n">node_y</span><span class="p">,</span> <span class="n">node_z</span><span class="p">,</span> <span class="n">cos_angle</span><span class="p">,</span> <span class="n">sin_angle</span> <span class="o">=</span> <span class="n">mechanical_node_positions</span><span class="p">(</span>
                    <span class="n">internal_node_id</span><span class="p">,</span>
                    <span class="n">num_nodes_stator</span><span class="p">,</span>
                    <span class="n">stator_bore_radius</span><span class="p">,</span>
                    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">offset_angle_degrees</span></a><span class="p">,</span>
                    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_x</span></a><span class="p">,</span>
                    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_y</span></a><span class="p">,</span>
                    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_z</span></a><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">this_fx</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">forces_stator_radial_per_slice</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">internal_node_id</span><span class="p">][</span><span class="n">step_index</span><span class="p">]</span> <span class="o">*</span> <span class="n">cos_angle</span>
                    <span class="o">+</span> <span class="n">forces_stator_tangential_per_slice</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">internal_node_id</span><span class="p">][</span><span class="n">step_index</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">sin_angle</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">slice_width</span>
                <span class="n">this_fy</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="o">-</span><span class="mi">1</span>
                    <span class="o">*</span> <span class="n">forces_stator_radial_per_slice</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">internal_node_id</span><span class="p">][</span><span class="n">step_index</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">sin_angle</span>
                    <span class="o">+</span> <span class="n">forces_stator_tangential_per_slice</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">internal_node_id</span><span class="p">][</span><span class="n">step_index</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">cos_angle</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">slice_width</span>
                <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">int_str_fixed_length_6</span><span class="p">(</span><span class="n">mesh_node_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">unv_float_short_str</span><span class="p">(</span><span class="n">this_fx</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">unv_float_short_str</span><span class="p">(</span><span class="n">this_fy</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">unv_float_short_str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Rotor</span>
            <span class="k">for</span> <span class="n">internal_node_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_nodes_rotor</span><span class="p">):</span>
                <span class="n">mesh_node_id</span> <span class="o">=</span> <span class="n">get_mesh_node_id</span><span class="p">(</span>
                    <span class="n">internal_node_id</span><span class="p">,</span> <span class="n">num_nodes_stator</span><span class="p">,</span> <span class="n">num_nodes_rotor</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">node_x</span><span class="p">,</span> <span class="n">node_y</span><span class="p">,</span> <span class="n">node_z</span><span class="p">,</span> <span class="n">cos_angle</span><span class="p">,</span> <span class="n">sin_angle</span> <span class="o">=</span> <span class="n">mechanical_node_positions</span><span class="p">(</span>
                    <span class="n">internal_node_id</span><span class="p">,</span>
                    <span class="n">num_nodes_rotor</span><span class="p">,</span>
                    <span class="n">rotor_radius</span><span class="p">,</span>
                    <span class="n">rotor_angle_deg</span> <span class="o">+</span> <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">offset_angle_degrees</span></a><span class="p">,</span>
                    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_x</span></a><span class="p">,</span>
                    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_y</span></a><span class="p">,</span>
                    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_z</span></a><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">this_fx</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">forces_rotor_radial_per_slice</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">internal_node_id</span><span class="p">][</span><span class="n">step_index</span><span class="p">]</span> <span class="o">*</span> <span class="n">cos_angle</span>
                    <span class="o">-</span> <span class="n">forces_rotor_tangential_per_slice</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">internal_node_id</span><span class="p">][</span><span class="n">step_index</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">sin_angle</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">slice_width</span>
                <span class="n">this_fy</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="o">-</span><span class="mi">1</span>
                    <span class="o">*</span> <span class="n">forces_rotor_radial_per_slice</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">internal_node_id</span><span class="p">][</span><span class="n">step_index</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">sin_angle</span>
                    <span class="o">-</span> <span class="n">forces_rotor_tangential_per_slice</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">internal_node_id</span><span class="p">][</span><span class="n">step_index</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">cos_angle</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">slice_width</span>
                <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">int_str_fixed_length_6</span><span class="p">(</span><span class="n">mesh_node_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">unv_float_short_str</span><span class="p">(</span><span class="n">this_fx</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">unv_float_short_str</span><span class="p">(</span><span class="n">this_fy</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">unv_float_short_str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># End of step</span>
            <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    -1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># End of load point</span>
        <span class="n">anf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">anf_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="main-script">
<h2>Main script:<a class="headerlink" href="#main-script" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">unv_filename</span></a> <span class="o">=</span> <span class="s2">&quot;Output.unv&quot;</span>
<a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">amesh_filename</span></a> <span class="o">=</span> <span class="s2">&quot;Output.amesh&quot;</span>
<a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">anf_filename</span></a> <span class="o">=</span> <span class="s2">&quot;Output.anf&quot;</span>

<span class="c1"># The offset_angle_degrees sets the position of the centre of a stator tooth relative to the X axis</span>
<span class="c1"># If this is set to zero, the first stator tooth is aligned with the X axis.</span>
<a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">offset_angle_degrees</span></a> <span class="o">=</span> <span class="mi">0</span>
<a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_x</span></a> <span class="o">=</span> <span class="mi">0</span>
<a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_y</span></a> <span class="o">=</span> <span class="mi">0</span>
<a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_z</span></a> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Connect to Motor-CAD. This assumes that the script is running from the scripting tab, and</span>
<span class="c1"># the model has been solved (or results loaded).</span>

<span class="c1"># Alternatively, this could be changed to pymotorcad.MotorCAD(open_new_instance=False) to connect</span>
<span class="c1"># to an existing instance if running from an external IDE.</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">pymotorcad</span><span class="o">.</span><span class="n">MotorCAD</span><span class="p">()</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;MessageDisplayState&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">if</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;SkewType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="c1"># Rotor skew type</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slices</span></a> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;RotorSkewSlices&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># No stepped rotor skew</span>
    <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slices</span></a> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Error for now if skew slices &gt; 1.</span>
<span class="c1"># This could be extended, so we write different AMESH and ANF files per slice</span>
<span class="k">if</span> <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slices</span></a> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only one rotor skew slice currently supported&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Do the export</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">export_to_motion_unv</span><span class="p">(</span>
        <span class="n">mc</span><span class="p">,</span>
        <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">unv_filename</span></a><span class="p">,</span>
        <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">amesh_filename</span></a><span class="p">,</span>
        <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">anf_filename</span></a><span class="p">,</span>
        <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">offset_angle_degrees</span></a><span class="p">,</span>
        <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_x</span></a><span class="p">,</span>
        <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_y</span></a><span class="p">,</span>
        <a href="https://docs.python.org/dev/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">slice_centre_z</span></a><span class="p">,</span>
    <span class="p">)</span>
<span class="k">except</span> <a href="https://docs.python.org/dev/library/exceptions.html#Exception" title="builtins.Exception" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-exception"><span class="n">pymotorcad</span><span class="o">.</span><span class="n">MotorCADError</span></a> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Motion export files not generated. Please check that force results are available&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception raised:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Motion export files not generated. Please check that force results are available
Exception raised:
No points exist
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 13.235 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-samples-general-motionforceexport-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/13dd1d04670e0b5013ef759c85fb29ec/MotionForceExport.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">MotionForceExport.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/140e85d8fbfe6f76e9d39cd6337ebc83/MotionForceExport.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">MotionForceExport.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/0a7f0fe86c10b512c8d61ace3b9693c5/MotionForceExport.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">MotionForceExport.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utility-functions-for-export">Utility functions for export:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-script">Main script:</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
<!-- If there is no fix edit button function, use the PyData edit-this-button-->
</div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <ul class="this-page-menu">
      <li><a href="../../_sources/samples/general/MotionForceExport.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>


  <!-- Include desired assets -->
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.7/require.min.js"></script>

<script>
// Passing the search options to the search.js file
const SEARCH_OPTIONS = JSON.parse('{"keys": ["title", "text"], "limit": 10, "threshold": 0.2}');
const SEARCH_FILE = "../../_static/search.json";
</script>


<script src="../../_static/js/search.js"></script>
  
  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright (c) 2026 ANSYS, Inc. All rights reserved.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the
  <a href="https://sphinxdocs.ansys.com/version/stable/index.html"
    >Ansys Sphinx Theme</a
  >
  1.3.3. <br />Last updated on
  <span id="ast_build_date"></span>
</p>
<script>
  var options = { day: "numeric", month: "long", year: "numeric" };
  var ast_lastModifiedDate = new Date(document.lastModified);
  var ast_build_date = ast_lastModifiedDate.toLocaleDateString("en-US", options);
  document.getElementById("ast_build_date").innerHTML = ast_build_date;
</script></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>