
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Motor-CAD Thermal Twin Builder ROM &#8212; pymotorcad-core</title>
  
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/css\ansys_sphinx_theme.css?v=0909a4fa" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://www.nerdfonts.com/assets/css/webfont.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=40c929c4" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />


  <!-- Include desired assets -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  

  
    <link href="../../_static/css/breadcrumbs.css" rel="stylesheet" />
  
    <script src="../../_static/documentation_options.js?v=0477e8c5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/links/thermal_twinbuilder';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://motorcad.docs.pyansys.com/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '0.8';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../../_static/ansys-favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Example scripts repository" href="../../samples/index.html" />
    <link rel="prev" title="Motor-CAD EMag Twin Builder ECE" href="ece_export_for_twinbuilder.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.8.4" />
  <link rel="canonical" href="https://motorcad.docs.pyansys.com/version/stable/examples/links/thermal_twinbuilder.html" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/pyansys_logo_transparent_black.png" class="logo__image only-light" alt="pymotorcad-core - Home"/>
    <img src="../../_static/pyansys_logo_transparent_white.png" class="logo__image only-dark pst-js-only" alt="pymotorcad-core - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user_guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../methods/index.html">
    API reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../samples/index.html">
    Example scripts repository
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../contributing.html">
    Contribute
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<div class="search-bar pst-js-only" id="search-bar">
  <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input type="search" class="form-control" name="q" placeholder="Search the docs ..."
      aria-label="Search the docs ..." autocomplete="off" autocorrect="off"
      autocapitalize="off" spellcheck="false" />
    <span class="search-button__kbd-shortcut">
      <kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd>
    </span>
  </form>
  <div id="static-search-results" class="static-search-results" style="display:none;" tabindex="0"></div>
</div>
        </div>
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pymotorcad" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pymotorcad/discussions" title="Support" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa fa-comment fa-fw fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Support</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<div class="search-bar pst-js-only" id="search-bar">
  <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input type="search" class="form-control" name="q" placeholder="Search the docs ..."
      aria-label="Search the docs ..." autocomplete="off" autocorrect="off"
      autocapitalize="off" spellcheck="false" />
    <span class="search-button__kbd-shortcut">
      <kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd>
    </span>
  </form>
  <div id="static-search-results" class="static-search-results" style="display:none;" tabindex="0"></div>
</div>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  
  
    <div id="announcement_msg"></div>
<script>
  fetch("announcement.html")
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error: ${response.status}`);
      }
      return response.text();
    })
    .then(
      (text) => (document.getElementById("announcement_msg").innerHTML = text),
    )
    .catch((error) => console.error(`Fetch problem: ${error.message}`));
</script>
  


  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user_guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../methods/index.html">
    API reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../samples/index.html">
    Example scripts repository
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../contributing.html">
    Contribute
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pymotorcad" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pymotorcad/discussions" title="Support" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa fa-comment fa-fw fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Support</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../adaptive_library/index.html">Adaptive templates examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">Basic examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internal_scripting/index.html">Internal scripting examples</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Linking examples</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ece_export_for_twinbuilder.html">Motor-CAD EMag Twin Builder ECE</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Motor-CAD Thermal Twin Builder ROM</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">
<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
         
    <li class="breadcrumb-item breadcrumb-home">
      <a href="https://docs.pyansys.com/" class="nav-link">PyAnsys</a>
    </li>
     
    <li class="breadcrumb-item">
      <a
        href="../../index.html"
        class="nav-link"
        aria-label="Home"
      >
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
     
    <li class="breadcrumb-item">
      <a href="../index.html" class="nav-link">Examples</a>
    </li>
     
    <li class="breadcrumb-item">
      <a href="index.html" class="nav-link">Linking examples</a>
    </li>
      
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Motor-CAD Thermal Twin Builder ROM</span></li>
    
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-links-thermal-twinbuilder-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="motor-cad-thermal-twin-builder-rom">
<span id="sphx-glr-examples-links-thermal-twinbuilder-py"></span><h1>Motor-CAD Thermal Twin Builder ROM<a class="headerlink" href="#motor-cad-thermal-twin-builder-rom" title="Link to this heading">#</a></h1>
<p>This example shows how to create the files needed to generate a Motor-CAD Thermal model using the
Twin Builder <em>Motor-CAD ROM</em> component.</p>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The Twin Builder <em>Motor-CAD ROM</em> component is available in Twin Builder 2024 R2 or
later.</p>
</div>
<p>Motor-CAD creates a thermal model of the motor using a Lumped Parameter Thermal Network (LPTN),
which allows the machine temperatures to be calculated. This LPTN thermal model can be formulated
as a set of thermal matrices. Motor-CAD provides the capability to export these, allowing the
thermal model to be imported into other engineering software packages. In general, the exported
model is accurate at a single speed, housing temperature, and airgap temperature (“operating
point”).</p>
<p>In Twin Builder 2024 R2 and later, a <em>Motor-CAD ROM</em> component can be created which extends upon
this idea, allowing for the creation of a Motor-CAD thermal model that is valid at a range of
operating points. It does this by utilizing data exported from several discrete operating points
to generate the component, and then automatically interpolating between these during a solve. The
component also solves the coolant flow model, ensuring accuracy for Motor-CAD models with cooling
systems enabled.</p>
<img alt="../../_images/Thermal_Twinbuilder_TwinBuilderROM.png" src="../../_images/Thermal_Twinbuilder_TwinBuilderROM.png" />
<p>The <em>Motor-CAD ROM</em> component is quick to set up and provides a significantly more accurate model
compared to the single operating point export. It has a user friendly interface with losses and
RPM as input pins, and component temperatures as output pins. Once generated, the component is
standalone (does not require Motor-CAD), thus allowing it to be shared/used in alternate systems
whilst obscuring the underlying Motor-CAD geometry.</p>
</section>
<section id="data-required-to-generate-a-motor-cad-rom-component">
<h2>Data required to generate a <em>Motor-CAD ROM</em> component<a class="headerlink" href="#data-required-to-generate-a-motor-cad-rom-component" title="Link to this heading">#</a></h2>
<p>To generate the component, within Ansys Electronics Desktop, go to the menu bar and select <strong>Twin
Builder</strong> &gt; <strong>Add Component</strong> &gt; <strong>Add Motor-CAD ROM Component…</strong>. This will present the
following window:</p>
<img alt="../../_images/Thermal_Twinbuilder_GenerateROM_Blank.png" src="../../_images/Thermal_Twinbuilder_GenerateROM_Blank.png" />
<p>The <strong>Input Files</strong> must point to the folder which contains the Motor-CAD data at the appropriate
operating points of interest, formatted in the appropriate manner. The script below is an example
showing how this can be done.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This script demonstrates how to obtain the data needed to generate a
<em>Motor-CAD ROM</em> component, as well as how to generate the component in Twin Builder.
For details on how the resulting <em>Motor-CAD ROM</em> component can be used, please
consult the Twin Builder Help Manual.</p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This script is designed to be run using Motor-CAD template “e8”. For other models,
modification of this script may be required.</p>
</div>
</section>
<section id="perform-required-imports">
<h2>Perform required imports<a class="headerlink" href="#perform-required-imports" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <a href="https://docs.python.org/dev/library/pathlib.html#pathlib.Path" title="pathlib.Path" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class"><span class="n">Path</span></a>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">ansys.motorcad.core</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pymotorcad</span>
</pre></div>
</div>
</section>
<section id="define-the-required-class">
<h2>Define the required Class<a class="headerlink" href="#define-the-required-class" title="Link to this heading">#</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">MotorCADTwinModel</span></code> class has been created to encapsulate the required logic. The resulting
object contains the data and functions to export the required Motor-CAD in the appropriate format.
A summary of the operations performed is as follows:</p>
<ol class="arabic simple">
<li><p>The Motor-CAD model calculation settings are configured</p></li>
<li><p>The thermal node numbers, node names and other required node data is determined</p></li>
<li><p>The cooling system nodes and flow path are identified and saved to the <code class="docutils literal notranslate"><span class="pre">CoolingSystems.csv</span></code>
file</p></li>
<li><p>For each desired speed, the thermal model is solved and thermal matrices exported and saved to
the <code class="docutils literal notranslate"><span class="pre">dpxxxxxx</span></code> folders</p></li>
<li><p>The distribution of the losses onto the individual nodes is determined and saved to the
<code class="docutils literal notranslate"><span class="pre">LossDistribution.csv</span></code> file</p></li>
<li><p>Natural convection cooling of the Housing is characterized and saved to the
<code class="docutils literal notranslate"><span class="pre">HousingTempDependency</span></code> folder</p></li>
<li><p>Temperature dependent Airgap heat transfer is characterized and saved to the
<code class="docutils literal notranslate"><span class="pre">AirGapTempDependency</span></code> folder</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MotorCADTwinModel</span><span class="p">:</span>
    <span class="c1"># Store required constants for the Motor-CAD Cooling System Node Group names (provided in the</span>
    <span class="c1"># ``.nmf`` file), corresponding parameter names for varying flowrate and inlet temperature</span>
    <span class="c1"># the Motor-CAD loss names (for display in Twinbuilder), and the corresponding Motor-CAD</span>
    <span class="c1"># parameter names.</span>
    <span class="n">coolingSystemData</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;End Space&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;Ventilated&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;TVent_Flow_Rate&quot;</span><span class="p">,</span> <span class="s2">&quot;TVent_Inlet_Temperature&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Housing Water Jacket&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;WJ_Fluid_Volume_Flow_Rate&quot;</span><span class="p">,</span> <span class="s2">&quot;HousingWJ_Inlet_Temperature&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Shaft Spiral Groove&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;Shaft_Groove_Fluid_Volume_Flow_Rate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Shaft_Groove_Fluid_Inlet_Temperature&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;Wet Rotor&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Wet_Rotor_Fluid_Volume_Flow_Rate&quot;</span><span class="p">,</span> <span class="s2">&quot;Wet_Rotor_Inlet_Temp&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Spray Cooling&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Spray_Cooling_Fluid_Volume_Flow_Rate&quot;</span><span class="p">,</span> <span class="s2">&quot;Spray_Cooling_Inlet_Temp&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Rotor Water Jacket&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Rotor_WJ_Fluid_Volume_Flow_Rate&quot;</span><span class="p">,</span> <span class="s2">&quot;RotorWJ_Inlet_Temp&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Slot Water Jacket&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Slot_WJ_Fluid_Volume_Flow_Rate&quot;</span><span class="p">,</span> <span class="s2">&quot;Slot_WJ_Fluid_inlet_temperature&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Heat Exchanger&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>

    <span class="n">lossNames</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Armature_Copper_dc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Armature_Copper_Freq_Comp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Main_Winding&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Aux_Winding&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stator_Back_Iron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stator_Tooth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Windage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Windage_Ext_Fan&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Friction_F_Bearing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Friction_R_Bearing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Magnet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Banding&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stator_Sleeve&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Embedded_Magnet_Pole&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Encoder&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Back_Iron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Tooth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Copper&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stray_Load_Stator_Iron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stray_Load_Rotor_Iron&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stray_Load_Stator_Copper&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stray_Load_Rotor_Copper&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Brush_Friction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Brush_VI&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">lossParameters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Armature_Copper_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Armature_Copper_Freq_Component_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Main_Winding_Copper_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Aux_Winding_Copper_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stator_Iron_Loss_@Ref_Speed_[Back_Iron]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stator_Iron_Loss_@Ref_Speed_[Tooth]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Windage_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Windage_Loss_(Ext_Fan)@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Friction_Loss_[F]_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Friction_Loss_[R]_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Magnet_Iron_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Magnet_Banding_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stator_Bore_Sleeve_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Iron_Loss_@Ref_Speed_[Embedded_Magnet_Pole]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Encoder_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Iron_Loss_@Ref_Speed_[Back_Iron]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Iron_Loss_@Ref_Speed_[Tooth]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Copper_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stator_Iron_Stray_Load_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Iron_Stray_Load_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Stator_Copper_Stray_Load_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Rotor_Copper_Stray_Load_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Brush_Friction_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Brush_VI_Loss_@Ref_Speed&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="c1"># Stator_Iron_Loss_@Ref_Speed_[Tooth_Tip] is not included as this is an unused Motor-CAD</span>
    <span class="c1"># parameter</span>

    <span class="c1"># Initialization function for objects of this class.</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputDir</span></a><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a> <span class="o">=</span> <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputDir</span></a>
        <span class="k">if</span> <span class="ow">not</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.isdir" title="os.path.isdir" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">):</span>
            <a href="https://docs.python.org/dev/library/os.html#os.makedirs" title="os.makedirs" class="sphx-glr-backref-module-os sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Motor-CAD input file: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TB data output dir: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">motFileName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heatFlowMethod</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeGroupings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluidInlet</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coolingSystems</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span> <span class="o">=</span> <span class="n">pymotorcad</span><span class="o">.</span><span class="n">MotorCAD</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;MessageDisplayState&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># check which Motor-CAD version is being used as this affects the resistance matrix format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motorcadV2025OrNewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">check_version_at_least</span><span class="p">(</span><span class="s2">&quot;2025.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a><span class="p">)</span>

    <span class="c1"># Main function to call which generates the required data for the Twin Builder export</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generateTwinData</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">housingAmbientTemperatures</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">airgapTemperatures</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coolingSystemsInputs</span></a><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateMotfile</span><span class="p">()</span>

        <span class="c1"># calculate self.nodeNames, self.nodeNumbers, self.nodeGroupings, self.nodeNumbers_fluid,</span>
        <span class="c1"># and self.nodeNumbers_fluidInlet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getNodeData</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generateCoolingSystemNetwork</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generateSamples</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># this changes the losses in the file, so do after samples obtained</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLossDistribution</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">housingAmbientTemperatures</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># uses fixed temperatures, so not dependent on losses</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generateHousingTempDependency</span><span class="p">(</span><span class="n">housingAmbientTemperatures</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">airgapTemperatures</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># uses fixed temperatures, so not dependent on losses</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generateAirgapTempDependency</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;rpm&quot;</span><span class="p">],</span> <span class="n">airgapTemperatures</span><span class="p">)</span>

        <span class="k">if</span> <a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coolingSystemsInputs</span></a> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generateCoolingSystemsInputsDependency</span><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coolingSystemsInputs</span></a><span class="p">)</span>

        <span class="c1"># write config file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;config.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">housingAmbientTemperatures</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;HousingTempDependency=1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;HousingTempDependency=0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">airgapTemperatures</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;AirGapTempDependency=1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;AirGapTempDependency=0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatFlowMethod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FluidHeatFlowMethod=1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FluidHeatFlowMethod=0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motorcadV2025OrNewer</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;MCADVersion=20251</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;MCADVersion=20242</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coolingSystemsInputs</span></a> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CoolingSystemsInputs=1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CoolingSystemsInputs=0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CopperLossScaling=0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SpeedDependentLosses=0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Helper functions to parse the exported Motor-CAD matrices (``.cmf``, ``.nmf``, ``.pmf``,</span>
    <span class="c1"># ``.rmf`` and .``.tmf``)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">unbracket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getExportedVector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">vector</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">lineSplit</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
                <span class="n">vector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lineSplit</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">vector</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getExportedMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">4</span><span class="p">:]</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">lineSplit</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineSplit</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lineSplit</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span>
                <span class="n">matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matrix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getPmfData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exportDirectory</span><span class="p">):</span>
        <span class="n">pmfFile</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motFileName</span> <span class="o">+</span> <span class="s2">&quot;.pmf&quot;</span><span class="p">)</span>
        <span class="c1"># exported power vector does not contain ambient, so add on</span>
        <span class="n">powerVector</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExportedVector</span><span class="p">(</span><span class="n">pmfFile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">powerVector</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getTmfData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exportDirectory</span><span class="p">):</span>
        <span class="n">tmfFile</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motFileName</span> <span class="o">+</span> <span class="s2">&quot;.tmf&quot;</span><span class="p">)</span>
        <span class="n">temperatureVector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExportedVector</span><span class="p">(</span><span class="n">tmfFile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temperatureVector</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getCmfData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exportDirectory</span><span class="p">):</span>
        <span class="n">cmfFile</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motFileName</span> <span class="o">+</span> <span class="s2">&quot;.cmf&quot;</span><span class="p">)</span>
        <span class="n">capacitanceMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExportedVector</span><span class="p">(</span><span class="n">cmfFile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">capacitanceMatrix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getRmfData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exportDirectory</span><span class="p">):</span>
        <span class="n">rmfFile</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motFileName</span> <span class="o">+</span> <span class="s2">&quot;.rmf&quot;</span><span class="p">)</span>
        <span class="n">resistanceMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getExportedMatrix</span><span class="p">(</span><span class="n">rmfFile</span><span class="p">)</span>

        <span class="c1"># resistance matrix exported by v2025R1 and newer is transposed vs older versions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motorcadV2025OrNewer</span><span class="p">:</span>
            <span class="n">resistanceMatrix</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">resistanceMatrix</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">resistanceMatrix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getNmfData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exportDirectory</span><span class="p">):</span>
        <span class="c1"># obtain the node numbers, node names, and node groupings from the nmf file</span>
        <span class="n">nmfFile</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motFileName</span> <span class="o">+</span> <span class="s2">&quot;.nmf&quot;</span><span class="p">)</span>
        <span class="n">nodeNumbers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodeNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodeGroupings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nmfFile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">groupName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span>
                        <span class="c1"># group name found</span>
                        <span class="n">groupName</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># node number and node name found</span>
                        <span class="n">lineSplit</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                        <span class="n">nodeNumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lineSplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="n">nodeNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineSplit</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">nodeGroupings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>

        <span class="c1"># sort based on the node numbers</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nodeNumbers</span><span class="p">,</span> <span class="n">nodeNames</span><span class="p">,</span> <span class="n">nodeGroupings</span><span class="p">))))</span>

    <span class="c1"># Functions to set and get the losses in the model, used to ensure the calculations are</span>
    <span class="c1"># performed with the correct losses and to determine the loss distribution</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setLosses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lossVector</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">lossParameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lossParameters</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="n">lossParameter</span><span class="p">,</span> <span class="n">lossVector</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getLosses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lossVector</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lossParameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lossParameters</span><span class="p">:</span>
            <span class="n">lossVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">lossParameter</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lossVector</span>

    <span class="c1"># Functions to update any mot file settings that need to be set appropriately</span>
    <span class="c1"># to ensure the correct calculations performed</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">updateMotfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># update the model settings to those needed for the TB export</span>
        <span class="c1"># 1 rpm</span>
        <span class="c1">## N/A no need to set RPM, this is done as required</span>
        <span class="c1"># 2 loss values</span>
        <span class="c1">## use a very small loss value</span>
        <span class="n">lossVector</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lossParameters</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLosses</span><span class="p">(</span><span class="n">lossVector</span><span class="p">)</span>
        <span class="c1"># 3 speed dep losses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;Speed_Dependant_Losses&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># 4 copper loss variation x2</span>
        <span class="c1">## turn off any temperature scaling losses as will affect loss distribution calculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;StatorCopperLossesVaryWithTemp&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;RotorCopperLossesVaryWithTemp&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># 5 calculation options x3</span>
        <span class="c1">## set calculation type to steadystate thermal-only (no coupling)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;ThermalCalcType&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;MagneticThermalCoupling&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;LabThermalCoupling&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># 6 matrix separator</span>
        <span class="c1">## export assumes comma is being used TODO use the original separator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;ExportTextSeparator&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="c1"># 7 windage losses</span>
        <span class="c1">## TB model will not include this logic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;Windage_Loss_Definition&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># 8 bearing losses</span>
        <span class="c1">## TB model will not include this logic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;BearingLossSource&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># detect heat flow method used (new option in 2024R2)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heatFlowMethod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;FluidHeatFlowMethod&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># variable does not exist due to using older version of Motor-CAD</span>
            <span class="c1"># set parameter to 0 which signifies use of the old method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heatFlowMethod</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># save the updated model so it is clear which Motor-CAD file can be used to validate</span>
        <span class="c1"># the Twin Builder Motor-CAD ROM component</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motFileName</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/pathlib.html#pathlib.Path" title="pathlib.Path" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class"><span class="n">Path</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;_TwinModel&quot;</span>
        <span class="n">usedMotFilePath</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motFileName</span> <span class="o">+</span> <span class="s2">&quot;.mot&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">usedMotFilePath</span><span class="p">)</span>

    <span class="c1"># Helper function that solves the Motor-CAD thermal network and exports the matrices,</span>
    <span class="c1"># setting any operating-point specific required settings beforehand</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">computeMatrices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exportDirectory</span><span class="p">,</span> <span class="n">rpm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lossVector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.isdir" title="os.path.isdir" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">):</span>
            <a href="https://docs.python.org/dev/library/os.html#os.makedirs" title="os.makedirs" class="sphx-glr-backref-module-os sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rpm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;Shaft_Speed_[RPM]&quot;</span><span class="p">,</span> <span class="n">rpm</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lossVector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLosses</span><span class="p">(</span><span class="n">lossVector</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">do_steady_state_analysis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">export_matrices</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

    <span class="c1"># Function that determines self.nodeNumbers, self.nodeNames, self.nodeGroupings,</span>
    <span class="c1"># self.nodeNumbers_fluidInlet and self.nodeNumbers_fluid</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">getNodeData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;initialization : compute matrices&quot;</span><span class="p">)</span>
        <span class="n">exportDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">computeMatrices</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeGroupings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNmfData</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>
        <span class="n">temperatureVector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTmfData</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

        <span class="c1"># determine which of the nodes is an inlet node</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">temperature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temperatureVector</span><span class="p">):</span>
            <span class="n">isInlet_check1</span> <span class="o">=</span> <span class="s2">&quot;inlet&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">isInlet_check2</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">10000000.0</span>
            <span class="n">isInlet_check3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeGroupings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coolingSystemData</span>

            <span class="k">if</span> <span class="n">isInlet_check1</span> <span class="ow">and</span> <span class="n">isInlet_check2</span> <span class="ow">and</span> <span class="n">isInlet_check3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluidInlet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluid</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">nodeNumber</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">nodeNumber</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeGroupings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coolingSystemData</span>
        <span class="p">]</span>

    <span class="c1"># Function that determines the nodes used for the cooling system and their connections. The</span>
    <span class="c1"># resulting data is required by Twin Builder to correctly model the fluid flow</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generateCoolingSystemNetwork</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;initialization : identifying cooling systems&quot;</span><span class="p">)</span>
        <span class="n">exportDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">computeMatrices</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;initialization : no cooling systems found&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;initialization : cooling systems found&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coolingSystems</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="n">resistanceMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRmfData</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>
            <span class="n">graphNodes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">graphEdges</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluid</span><span class="p">:</span>
                <span class="n">connectedNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">returnConnectedNodes</span><span class="p">(</span>
                    <span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluid</span><span class="p">,</span> <span class="n">resistanceMatrix</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graphNodes</span><span class="p">:</span>
                    <span class="n">graphNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">connectedNode</span> <span class="ow">in</span> <span class="n">connectedNodes</span><span class="p">:</span>
                    <span class="n">graphEdges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">node</span><span class="p">,</span> <span class="n">connectedNode</span><span class="p">])</span>

            <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">graphNodes</span><span class="p">)</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">graphEdges</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">adjacency_matrix</span><span class="p">(</span><span class="n">G</span><span class="p">)</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>

            <span class="n">inletNodes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">connectedNodesLists</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">graphNode</span> <span class="ow">in</span> <span class="n">graphNodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">graphNode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluidInlet</span><span class="p">:</span>
                    <span class="n">inletNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphNode</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">graphNode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inletNodes</span><span class="p">):</span>
                <span class="n">connectedNodesList</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">connectedNodesInd</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">node</span> <span class="o">=</span> <span class="n">graphNode</span>
                <span class="nb">next</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="nb">next</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">covered</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">curGraphEdges</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">graphNodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">graphNodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">covered</span><span class="p">:</span>
                            <span class="c1"># don&#39;t consider first connection for the power correction</span>
                            <span class="k">if</span> <span class="n">node</span> <span class="o">!=</span> <span class="n">graphNode</span><span class="p">:</span>
                                <span class="n">connectedNodesList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span>
                                        <span class="p">),</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">graphNodes</span><span class="p">[</span><span class="n">k</span><span class="p">])]</span>
                                        <span class="p">),</span>
                                    <span class="p">]</span>
                                <span class="p">)</span>
                                <span class="n">connectedNodesInd</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">node</span><span class="p">,</span> <span class="n">graphNodes</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>

                            <span class="n">curGraphEdges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">node</span><span class="p">,</span> <span class="n">graphNodes</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>
                            <span class="k">if</span> <span class="n">graphNodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">:</span>
                                <span class="nb">next</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphNodes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="nb">next</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="n">covered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

                <span class="n">curG</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
                <span class="n">curG</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">graphNodes</span><span class="p">)</span>
                <span class="n">curG</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">curGraphEdges</span><span class="p">)</span>
                <span class="n">connectedNodesLists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connectedNodesList</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coolingSystems</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">graphNode</span><span class="p">:</span> <span class="n">connectedNodesInd</span><span class="p">})</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">curG</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">graphNode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_cooling.png&quot;</span><span class="p">))</span>

            <span class="c1"># write cooling systems config file</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectedNodesLists</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;CoolingSystems.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">connectedNodesList</span> <span class="ow">in</span> <span class="n">connectedNodesLists</span><span class="p">:</span>
                        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="s2">&quot;inlet : &quot;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inletNodes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                            <span class="o">+</span> <span class="s2">&quot; - &quot;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">inletNodes</span><span class="p">[</span><span class="n">k</span><span class="p">])])</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">connectedNodes</span> <span class="ow">in</span> <span class="n">connectedNodesList</span><span class="p">:</span>
                            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">returnConnectedNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">nodeList</span><span class="p">,</span> <span class="n">resistanceMatrix</span><span class="p">):</span>
        <span class="n">nodeIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">resistanceRow</span> <span class="o">=</span> <span class="n">resistanceMatrix</span><span class="p">[</span><span class="n">nodeIndex</span><span class="p">]</span>

        <span class="n">connectedNodesList</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">resistance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resistanceRow</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">resistance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">resistance</span> <span class="o">&lt;</span> <span class="mf">1000000000.0</span><span class="p">):</span>
                <span class="c1"># there is a connection</span>
                <span class="n">connectedNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">connectedNode</span> <span class="ow">in</span> <span class="n">nodeList</span><span class="p">:</span>
                    <span class="n">connectedNodesList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connectedNode</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">connectedNodesList</span>

    <span class="c1"># Function that runs the thermal model at each desired speed, and exports the thermal matrices</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generateSamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">rpmSamples</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;rpm&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">rpm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rpmSamples</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DoE : computing sample point rpm = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rpm</span><span class="p">))</span>
            <span class="n">exportDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;dp&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">computeMatrices</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">,</span> <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">)</span>

        <span class="c1"># write doe file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;doe.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">)</span>
            <span class="n">parameterNames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">parameterValues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">nbDPs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameterValues</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">parameterName</span> <span class="ow">in</span> <span class="n">parameterNames</span><span class="p">:</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parameterName</span><span class="p">))</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nbDPs</span><span class="p">):</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;dp&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameterNames</span><span class="p">)):</span>
                    <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parameterValues</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Function that extracts the per-node loss distribution for each loss type, allowing the user to</span>
    <span class="c1"># specify a loss value using a name (such as Armature Copper Loss) and have Twin Builder</span>
    <span class="c1"># automatically distribute this amongst appropriate nodes.</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generateLossDistribution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">numLossParameters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lossNames</span><span class="p">)</span>
        <span class="n">lossDistributionMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numLossParameters</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">)))</span>

        <span class="c1"># use a small loss value of 1W</span>
        <span class="n">inputLoss</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">lossIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numLossParameters</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;power distribution &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lossIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">numLossParameters</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; : &quot;</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lossNames</span><span class="p">[</span><span class="n">lossIndex</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">exportDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;dis&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lossIndex</span><span class="p">))</span>

            <span class="n">lossVector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numLossParameters</span><span class="p">)</span>
            <span class="n">lossVector</span><span class="p">[</span><span class="n">lossIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputLoss</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">computeMatrices</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">,</span> <span class="n">lossVector</span><span class="o">=</span><span class="n">lossVector</span><span class="p">)</span>

            <span class="n">powerVector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPmfData</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">nodeIndex</span><span class="p">,</span> <span class="n">nodePower</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">powerVector</span><span class="p">):</span>
                <span class="c1"># ignore nodes with negative loss (cooling systems)</span>
                <span class="k">if</span> <span class="n">nodePower</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lossDistributionMatrix</span><span class="p">[</span><span class="n">lossIndex</span><span class="p">,</span> <span class="n">nodeIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodePower</span> <span class="o">/</span> <span class="n">inputLoss</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;LossDistribution.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">nodeName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">:</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">nodeName</span><span class="p">)</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">lossName</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lossNames</span><span class="p">):</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lossName</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">nodeLoss</span> <span class="ow">in</span> <span class="n">lossDistributionMatrix</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nodeLoss</span><span class="p">))</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Function that determines the Housing to Ambient resistances at different housing temperatures,</span>
    <span class="c1"># the results of which are used by Twin Builder to take into account external Natural Convection</span>
    <span class="c1"># cooling.</span>
    <span class="c1"># The input parameter is a dict, format e.g.: {tAmbient1:[tHousing1, ..., tHousingx],</span>
    <span class="c1"># tAmbient2:[tHousing1,..., tHousingy], tAmbient3:[tHousing1, ..., tHousingx]}</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generateHousingTempDependency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">housingAmbientTemperatures</span><span class="p">):</span>
        <span class="n">housingNodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">nodeNumber</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">nodeNumber</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeGroupings</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Housing&quot;</span> <span class="ow">or</span> <span class="n">nodeNumber</span> <span class="o">==</span> <span class="mi">5</span>
        <span class="p">]</span>

        <span class="n">fileInd</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ambientTemperature</span><span class="p">,</span> <span class="n">fixedHousingTemperatures</span> <span class="ow">in</span> <span class="n">housingAmbientTemperatures</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fileInd</span> <span class="o">=</span> <span class="n">fileInd</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tamb: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ambientTemperature</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;T_Ambient&quot;</span><span class="p">,</span> <span class="n">ambientTemperature</span><span class="p">)</span>
            <span class="n">file_content</span><span class="p">,</span> <span class="n">header_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMatricesHousingTemps</span><span class="p">(</span>
                <span class="n">housingNodes</span><span class="p">,</span> <span class="n">ambientTemperature</span><span class="p">,</span> <span class="n">fixedHousingTemperatures</span>
            <span class="p">)</span>

            <span class="n">exportDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;HousingTempDependency&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.isdir" title="os.path.isdir" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">):</span>
                <a href="https://docs.python.org/dev/library/os.html#os.makedirs" title="os.makedirs" class="sphx-glr-backref-module-os sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span></a><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">))</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">,</span> <span class="s2">&quot;Housing_Temp&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileInd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">header_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">header_line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">file_content</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">computeMatricesHousingTemps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">housingNodes</span><span class="p">,</span> <span class="n">ambientTemperature</span><span class="p">,</span> <span class="n">fixedHousingTemperatures</span>
    <span class="p">):</span>
        <span class="n">exportDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>

        <span class="n">file_content</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">housingTemperature</span> <span class="ow">in</span> <span class="n">fixedHousingTemperatures</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HousingTemp: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">housingTemperature</span><span class="p">))</span>

            <span class="c1"># Set the fixed temperature</span>
            <span class="k">for</span> <span class="n">housingNode</span> <span class="ow">in</span> <span class="n">housingNodes</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Housing Node &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">housingNode</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_fixed_temperature_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">housingNode</span><span class="p">,</span> <span class="n">housingTemperature</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">computeMatrices</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

            <span class="n">resistanceMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRmfData</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>
            <span class="n">ambientResistances</span> <span class="o">=</span> <span class="n">resistanceMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">housingResistances</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">housingNode</span> <span class="ow">in</span> <span class="n">housingNodes</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">housingNode</span><span class="p">)</span>
                <span class="n">housingResistances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ambientResistances</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

            <span class="n">file_content</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">housingTemperature</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">:</span> <span class="n">housingResistances</span><span class="p">})</span>

        <span class="n">header_line</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">header_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ambientTemperature</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">housingNode</span> <span class="ow">in</span> <span class="n">housingNodes</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">housingNode</span><span class="p">)</span>
            <span class="n">header_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">file_content</span><span class="p">,</span> <span class="n">header_line</span>

    <span class="c1"># Function that determines the Stator to Rotor airgap resistance at different housing</span>
    <span class="c1"># temperatures, the results of which are used by Twin Builder to take into account the</span>
    <span class="c1"># temperature dependent nature of this resistance</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generateAirgapTempDependency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rpmSamples</span><span class="p">,</span> <span class="n">airgapTemperatures</span><span class="p">):</span>
        <span class="n">fileInd</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">rpm</span> <span class="ow">in</span> <span class="n">rpmSamples</span><span class="p">:</span>
            <span class="n">fileInd</span> <span class="o">=</span> <span class="n">fileInd</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RPM : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rpm</span><span class="p">))</span>

            <span class="n">file_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMatricesAirgapTemp</span><span class="p">(</span><span class="n">airgapTemperatures</span><span class="p">,</span> <span class="n">rpm</span><span class="p">)</span>

            <span class="n">exportPath</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;AirGapTempDependency&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.isdir" title="os.path.isdir" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">):</span>
                <a href="https://docs.python.org/dev/library/os.html#os.makedirs" title="os.makedirs" class="sphx-glr-backref-module-os sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span></a><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">))</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">,</span> <span class="s2">&quot;AirGap_Temp&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileInd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rpm</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">file_content</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">computeMatricesAirgapTemp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">airgapTemperatures</span><span class="p">,</span> <span class="n">rpm</span><span class="p">):</span>
        <span class="n">exportDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>

        <span class="c1"># Airgap nodes between which there is a temperature dependent resistance</span>
        <span class="n">airgapNodeStator</span><span class="p">,</span> <span class="n">airgapNodeRotor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAirgapNodes</span><span class="p">()</span>

        <span class="n">file_content</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Loop over each airgap average temperature</span>
        <span class="k">for</span> <span class="n">airgapTemperature</span> <span class="ow">in</span> <span class="n">airgapTemperatures</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Air Gap average temperature: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">airgapTemperature</span><span class="p">))</span>

            <span class="c1"># Set the fixed temperature</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Airgap_Stator_Node_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">airgapNodeStator</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_fixed_temperature_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">airgapNodeStator</span><span class="p">,</span> <span class="n">airgapTemperature</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Airgap_Rotor_Node_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">airgapNodeRotor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_fixed_temperature_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">airgapNodeRotor</span><span class="p">,</span> <span class="n">airgapTemperature</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">computeMatrices</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">,</span> <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">)</span>
            <span class="n">resistanceMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRmfData</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

            <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">airgapNodeStator</span><span class="p">)</span>
            <span class="n">index2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">airgapNodeRotor</span><span class="p">)</span>
            <span class="n">airgapResistance</span> <span class="o">=</span> <span class="n">resistanceMatrix</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span>

            <span class="n">file_content</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">airgapTemperature</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">:</span> <span class="n">airgapResistance</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">file_content</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getAirgapNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tVent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;ThroughVentilation&quot;</span><span class="p">)</span>
        <span class="n">sVent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;SelfVentilation&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tVent</span> <span class="ow">or</span> <span class="n">sVent</span><span class="p">:</span>
            <span class="n">statorCoolingOnly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;TVent_NoAirgapFlow&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">statorCoolingOnly</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <a href="https://docs.python.org/dev/library/warnings.html#warnings.warn" title="warnings.warn" class="sphx-glr-backref-module-warnings sphx-glr-backref-type-py-function"><span class="n">warnings</span><span class="o">.</span><span class="n">warn</span></a><span class="p">(</span>
                    <span class="s2">&quot;Temperature dependent airgap not supported for ventilated cooling with airgap&quot;</span>
                    <span class="s2">&quot;flow&quot;</span>
                <span class="p">)</span>

        <span class="n">wetrotor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Wet_Rotor&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wetrotor</span><span class="p">:</span>
            <a href="https://docs.python.org/dev/library/warnings.html#warnings.warn" title="warnings.warn" class="sphx-glr-backref-module-warnings sphx-glr-backref-type-py-function"><span class="n">warnings</span><span class="o">.</span><span class="n">warn</span></a><span class="p">(</span><span class="s2">&quot;Temperature dependent airgap not supported for wet rotor&quot;</span><span class="p">)</span>

        <span class="n">axialSlices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;AxialSliceDefinition&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axialSlices</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <a href="https://docs.python.org/dev/library/warnings.html#warnings.warn" title="warnings.warn" class="sphx-glr-backref-module-warnings sphx-glr-backref-type-py-function"><span class="n">warnings</span><span class="o">.</span><span class="n">warn</span></a><span class="p">(</span><span class="s2">&quot;Temperature dependent airgap only supported for middle axial slice&quot;</span><span class="p">)</span>

        <span class="n">sleeveThickness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;Sleeve_Thickness&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sleeveThickness</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># sleeve node present on stator side</span>
            <span class="n">airgapNodeStator</span> <span class="o">=</span> <span class="mi">61</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">airgapNodeStator</span> <span class="o">=</span> <span class="mi">11</span>

        <span class="n">airgapNodeRotor</span> <span class="o">=</span> <span class="mi">12</span>

        <span class="k">return</span> <span class="n">airgapNodeStator</span><span class="p">,</span> <span class="n">airgapNodeRotor</span>

    <span class="c1"># Function that determines Cooling Systems nodes&#39; resistances/capacitances at</span>
    <span class="c1"># different RPM, coolant flow rate and inlet temperatures, the results of which</span>
    <span class="c1"># are used by Twin Builder to take into account the Cooling Systems inputs</span>
    <span class="c1"># dependencies. coolingSystemsInputs is a dictionary with keys describing</span>
    <span class="c1"># the Cooling System name and value being another dictionary storing</span>
    <span class="c1"># the parameter (RPM, Flow Rate, Inlet Temperature) values to evaluate</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generateCoolingSystemsInputsDependency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coolingSystemsInputs</span></a><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">coolingSystem</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coolingSystemsInputs</span></a><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">coolingSystem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coolingSystemData</span><span class="p">:</span>
                <a href="https://docs.python.org/dev/library/warnings.html#warnings.warn" title="warnings.warn" class="sphx-glr-backref-module-warnings sphx-glr-backref-type-py-function"><span class="n">warnings</span><span class="o">.</span><span class="n">warn</span></a><span class="p">(</span>
                    <span class="s2">&quot;The Cooling System name </span><span class="si">{}</span><span class="s2"> is not part of the list of Cooling Systems &quot;</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coolingSystem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coolingSystemData</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">return</span>

            <span class="n">exportPath</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span><span class="n">coolingSystem</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.isdir" title="os.path.isdir" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">):</span>
                <a href="https://docs.python.org/dev/library/os.html#os.makedirs" title="os.makedirs" class="sphx-glr-backref-module-os sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span></a><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">))</span>

            <a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rpms</span></a> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;rpm&quot;</span><span class="p">]</span>
            <span class="n">frs</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;FR&quot;</span><span class="p">]</span>
            <span class="n">inletTemps</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;inletTemp&quot;</span><span class="p">]</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">,</span> <span class="s2">&quot;dp_values.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;rpm=[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rpms</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rpms</span></a><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FR=[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">frs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">frs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;inletTemp=[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inletTemps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">inletTemps</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">))</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># identify all the impacted resistances and capacitances</span>
            <span class="n">exportDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>

            <span class="n">resistanceMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRmfData</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>
            <span class="n">r_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">c_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">,</span> <span class="s2">&quot;c_nodes.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fCout</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span>
                <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">,</span> <span class="s2">&quot;r_nodes.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">fRout</span><span class="p">:</span>
                <span class="n">covered_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">inNode</span><span class="p">,</span> <span class="n">conList</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coolingSystems</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeGroupings</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">inNode</span><span class="p">)]</span> <span class="o">==</span> <span class="n">coolingSystem</span><span class="p">:</span>
                        <span class="n">upnode</span> <span class="o">=</span> <span class="n">inNode</span>
                        <span class="n">coolSys</span> <span class="o">=</span> <span class="n">conList</span>

                <span class="n">connectedNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">returnConnectedNodes</span><span class="p">(</span>
                    <span class="n">upnode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="p">,</span> <span class="n">resistanceMatrix</span>
                <span class="p">)</span>  <span class="c1"># inlet node</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">)):</span>
                    <span class="n">fRout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)])</span>
                        <span class="o">+</span> <span class="s2">&quot; &quot;</span>
                        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">])])</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">r_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">upnode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluidInlet</span><span class="p">:</span>
                        <span class="n">fCout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="n">c_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)]])</span>
                <span class="n">covered_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">upnode</span><span class="p">:</span> <span class="n">connectedNodes</span><span class="p">})</span>

                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">coolSys</span><span class="p">:</span>  <span class="c1"># following downstream nodes of the cooling system</span>
                    <span class="k">for</span> <span class="n">upnode</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">upnode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">covered_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="n">connectedNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">returnConnectedNodes</span><span class="p">(</span>
                                <span class="n">upnode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="p">,</span> <span class="n">resistanceMatrix</span>
                            <span class="p">)</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">)):</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                                    <span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">covered_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                    <span class="ow">and</span> <span class="n">upnode</span> <span class="ow">in</span> <span class="n">covered_nodes</span><span class="p">[</span><span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                                <span class="p">):</span>  <span class="c1"># avoid taking the symmetric counterpart of the resistance</span>
                                    <span class="n">fRout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)]</span>
                                        <span class="p">)</span>
                                        <span class="o">+</span> <span class="s2">&quot; &quot;</span>
                                        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                            <span class="p">]</span>
                                        <span class="p">)</span>
                                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                                    <span class="p">)</span>
                                    <span class="n">r_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                        <span class="p">[</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                            <span class="p">],</span>
                                        <span class="p">]</span>
                                    <span class="p">)</span>
                            <span class="k">if</span> <span class="n">upnode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluidInlet</span><span class="p">:</span>
                                <span class="n">fCout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)])</span>
                                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="p">)</span>
                                <span class="n">c_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)]])</span>
                            <span class="n">covered_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">upnode</span><span class="p">:</span> <span class="n">connectedNodes</span><span class="p">})</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">coolSys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="p">):</span>  <span class="c1"># particular case where the cooling system has only 2 nodes (inlet/outlet)</span>
                    <span class="k">for</span> <span class="n">upnode</span> <span class="ow">in</span> <span class="n">connectedNodes</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeGroupings</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)]</span> <span class="o">==</span> <span class="n">coolingSystem</span>
                        <span class="p">):</span>  <span class="c1"># make sure the connected node still belongs to cooling system</span>
                            <span class="n">connectedNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">returnConnectedNodes</span><span class="p">(</span>
                                <span class="n">upnode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="p">,</span> <span class="n">resistanceMatrix</span>
                            <span class="p">)</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">)):</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                                    <span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">covered_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                    <span class="ow">and</span> <span class="n">upnode</span> <span class="ow">in</span> <span class="n">covered_nodes</span><span class="p">[</span><span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                                <span class="p">):</span>  <span class="c1"># avoid taking the symmetric counterpart of the resistance</span>
                                    <span class="n">fRout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)]</span>
                                        <span class="p">)</span>
                                        <span class="o">+</span> <span class="s2">&quot; &quot;</span>
                                        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                            <span class="p">]</span>
                                        <span class="p">)</span>
                                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                                    <span class="p">)</span>
                                    <span class="n">r_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                        <span class="p">[</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">connectedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                            <span class="p">],</span>
                                        <span class="p">]</span>
                                    <span class="p">)</span>
                                <span class="k">if</span> <span class="n">upnode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers_fluidInlet</span><span class="p">:</span>
                                    <span class="n">fCout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">unbracket</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)]</span>
                                        <span class="p">)</span>
                                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                                    <span class="p">)</span>
                                    <span class="n">c_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeNumbers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upnode</span><span class="p">)]])</span>
                            <span class="n">covered_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">upnode</span><span class="p">:</span> <span class="n">connectedNodes</span><span class="p">})</span>

            <span class="c1"># run the DoE</span>
            <span class="n">fileInd</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">nDps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frs</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">inletTemps</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rpms</span></a><span class="p">)</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">frs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">inTemp</span> <span class="ow">in</span> <span class="n">inletTemps</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rpms</span></a><span class="p">:</span>
                        <span class="n">fileInd</span> <span class="o">=</span> <span class="n">fileInd</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="s2">&quot;Run DP </span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2"> for cooling system </span><span class="si">{}</span><span class="s2"> at parameters values flow rate &quot;</span>
                                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, inlet temperature </span><span class="si">{}</span><span class="s2"> and rpm </span><span class="si">{}</span><span class="s2">&quot;</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileInd</span><span class="p">,</span> <span class="n">nDps</span><span class="p">,</span> <span class="n">coolingSystem</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">inTemp</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="p">[</span><span class="n">R</span><span class="p">,</span> <span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMatricesCoolingSystemsInput</span><span class="p">(</span>
                            <span class="n">coolingSystem</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">inTemp</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">r_list</span><span class="p">,</span> <span class="n">c_list</span><span class="p">,</span> <span class="n">fileInd</span>
                        <span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                            <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileInd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span>
                        <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">inTemp</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">R</span><span class="p">:</span>
                                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                            <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">exportPath</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileInd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span>
                        <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">inTemp</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
                                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">computeMatricesCoolingSystemsInput</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">coolingSystem</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">inTemp</span><span class="p">,</span> <span class="n">fr</span><span class="p">,</span> <span class="n">r_list</span><span class="p">,</span> <span class="n">c_list</span><span class="p">,</span> <span class="n">fileInd</span>
    <span class="p">):</span>
        <span class="n">exportDirectory</span> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;dp&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileInd</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.isdir" title="os.path.isdir" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">):</span>
            <a href="https://docs.python.org/dev/library/os.html#os.makedirs" title="os.makedirs" class="sphx-glr-backref-module-os sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span></a><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;Shaft_Speed_[RPM]&quot;</span><span class="p">,</span> <span class="n">rpm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coolingSystemData</span><span class="p">[</span><span class="n">coolingSystem</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coolingSystemData</span><span class="p">[</span><span class="n">coolingSystem</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">inTemp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">do_steady_state_analysis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcad</span><span class="o">.</span><span class="n">export_matrices</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

        <span class="n">resistanceMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRmfData</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>
        <span class="n">capacitanceMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCmfData</span><span class="p">(</span><span class="n">exportDirectory</span><span class="p">)</span>

        <span class="n">R</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">r_list</span><span class="p">:</span>
            <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">index2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">resistance</span> <span class="o">=</span> <span class="n">resistanceMatrix</span><span class="p">[</span><span class="n">index1</span><span class="p">][</span><span class="n">index2</span><span class="p">]</span>
            <span class="n">R</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resistance</span><span class="p">)</span>

        <span class="n">C</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">c_list</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodeNames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">)</span>  <span class="c1"># -1 since capacitance matrix does not have ambient node</span>
            <span class="n">capacitance</span> <span class="o">=</span> <span class="n">capacitanceMatrix</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">capacitance</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">R</span><span class="p">,</span> <span class="n">C</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="example-use-case">
<h2>Example use case<a class="headerlink" href="#example-use-case" title="Link to this heading">#</a></h2>
<p>Below is an example of how the above <code class="docutils literal notranslate"><span class="pre">MotorCADTwinModel</span></code> class can be used using the
<code class="docutils literal notranslate"><span class="pre">e8_eMobility</span></code> template .mot file.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">generateTwinData</span></code> method accepts as an optional parameter a dictionary of Housing and
Ambient temperatures to be investigated. This can be provided if Natural Convection cooling of the
housing should be modelled in the Twin Builder <em>Motor-CAD ROM</em> component. For this example, a
function has been defined to return this dictionary. As can be seen in the code comments, more
data points are calculated when the housing and ambient temperatures are close together, as this
is where the natural convection heat transfer coefficients vary the most.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">temperaturesHousingAmbient</span><span class="p">():</span>
    <span class="c1"># Consider ambient temperature as 20, 40, 65</span>
    <span class="c1"># For each ambient temperature run housing nodes sweep between 20 and 100 deg</span>
    <span class="c1"># 0&lt;= abs(dT) &lt;= 5 -&gt; 0.5 deg =&gt; 10 points</span>
    <span class="c1"># 5 &lt; abs(dT) &lt;= 15 -&gt; 1 deg =&gt; 10 points</span>
    <span class="c1"># 15 &lt; abs(dT) &lt;= 40 -&gt; 5 deg =&gt; 5 points</span>
    <span class="c1"># 40 &lt; abs(dT) -&gt; 10 deg</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Determining Ambient and Housing temperatures to investigate:&quot;</span><span class="p">)</span>
    <span class="n">temperatures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">ambientTemperatures</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
    <span class="n">housingTemperatureMin</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">housingTemperatureMax</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="k">for</span> <span class="n">ambientTemperature</span> <span class="ow">in</span> <span class="n">ambientTemperatures</span><span class="p">:</span>
        <span class="n">housingTemperatures</span> <span class="o">=</span> <span class="p">[</span><span class="n">housingTemperatureMin</span><span class="p">]</span>
        <span class="n">curTemp</span> <span class="o">=</span> <span class="n">housingTemperatureMin</span>
        <span class="k">while</span> <span class="n">curTemp</span> <span class="o">&lt;</span> <span class="n">housingTemperatureMax</span><span class="p">:</span>
            <span class="n">curdT</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">curTemp</span> <span class="o">-</span> <span class="n">ambientTemperature</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">curdT</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">dT</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">elif</span> <span class="n">curdT</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
                <span class="n">dT</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">curdT</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="n">dT</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dT</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">curTemp</span> <span class="o">=</span> <span class="n">curTemp</span> <span class="o">+</span> <span class="n">dT</span>
            <span class="n">housingTemperatures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curTemp</span><span class="p">)</span>

        <span class="n">temperatures</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ambientTemperature</span><span class="p">:</span> <span class="n">housingTemperatures</span><span class="p">})</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">temperatures</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">temperatures</span>
</pre></div>
</div>
<p>Specify the input .mot file and the directory to save the output data to.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">working_folder</span></a> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.html#os.getcwd" title="os.getcwd" class="sphx-glr-backref-module-os sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span></a><span class="p">()</span>
<a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mcad_name</span></a> <span class="o">=</span> <span class="s2">&quot;e8_mobility&quot;</span>
<a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">working_folder</span></a><span class="p">,</span> <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mcad_name</span></a> <span class="o">+</span> <span class="s2">&quot;.mot&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputDir</span></a> <span class="o">=</span> <a href="https://docs.python.org/dev/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">working_folder</span></a><span class="p">,</span> <span class="s2">&quot;thermal_twinbuilder_&quot;</span> <span class="o">+</span> <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mcad_name</span></a><span class="p">)</span>
</pre></div>
</div>
<p>Create the e8 input file if it does not exist already.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <a href="https://docs.python.org/dev/library/pathlib.html#pathlib.Path" title="pathlib.Path" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class"><span class="n">Path</span></a><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="n">motorcad</span> <span class="o">=</span> <span class="n">pymotorcad</span><span class="o">.</span><span class="n">MotorCAD</span><span class="p">()</span>
    <span class="n">motorcad</span><span class="o">.</span><span class="n">load_template</span><span class="p">(</span><span class="s2">&quot;e8&quot;</span><span class="p">)</span>
    <span class="n">motorcad</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a><span class="p">)</span>
    <span class="n">motorcad</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
<p>Choose the speed points that the model should be solved at. The generated <em>Motor-CAD ROM</em>
component will interpolate between these, so it is important to cover the complete speed range
with the appropriate sampling in order to maintain accuracy. Three points have been chosen here to
reduce calculation time, but in real use it is recommended that this be greater.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rpms</span></a> <span class="o">=</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
</pre></div>
</div>
<p>Specify the airgap temperatures to investigate, in order for the temperature dependent nature
of the airgap heat transfer to be included in the <em>Motor-CAD ROM</em> component. The generated
<em>Motor-CAD ROM</em> component will interpolate between these, so it is important to cover the complete
expected airgap temperature range with the appropriate sampling in order to maintain accuracy.
This parameter can be set to <code class="docutils literal notranslate"><span class="pre">None</span></code> should this not be required.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">airgapTemps</span></a> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>
</pre></div>
</div>
<p>Specify the housing and ambient temperatures to investigate, in order for the natural
convection cooling of the housing to be be included in the <em>Motor-CAD ROM</em> component. The
generated <em>Motor-CAD ROM</em> component will interpolate between these, so it is important to cover
the complete expected housing and ambient temperature range with the appropriate sampling in order
to maintain accuracy. This parameter can be set to <code class="docutils literal notranslate"><span class="pre">None</span></code> should this not be required.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">housingAmbientTemps</span></a> <span class="o">=</span> <span class="n">temperaturesHousingAmbient</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Determining Ambient and Housing temperatures to investigate:
{20: [20, 20.5, 21.0, 21.5, 22.0, 22.5, 23.0, 23.5, 24.0, 24.5, 25.0, 26.0, 27.0, 28.0, 29.0, 30.0, 31.0, 32.0, 33.0, 34.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 70.0, 80.0, 90.0, 100.0], 40: [20, 25, 30, 31, 32, 33, 34, 35, 36, 36.5, 37.0, 37.5, 38.0, 38.5, 39.0, 39.5, 40.0, 40.5, 41.0, 41.5, 42.0, 42.5, 43.0, 43.5, 44.0, 44.5, 45.0, 46.0, 47.0, 48.0, 49.0, 50.0, 51.0, 52.0, 53.0, 54.0, 55.0, 60.0, 65.0, 70.0, 75.0, 80.0, 90.0, 100.0]}
</pre></div>
</div>
<p>Specify the cooling systems for which input dependencies need to be taken into account.
For each cooling system involved, define the parameters values to sweep to extract the
corresponding training data.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coolingSystemsInputs</span></a> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Housing Water Jacket&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;rpm&quot;</span><span class="p">:</span> <a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rpms</span></a><span class="p">,</span>
        <span class="s2">&quot;FR&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">9.7695e-05</span><span class="p">,</span> <span class="mf">0.000103122499999999</span><span class="p">,</span> <span class="mf">0.00010855</span><span class="p">,</span> <span class="mf">0.0001139775</span><span class="p">,</span> <span class="mf">0.000119405</span><span class="p">],</span>
        <span class="s2">&quot;inletTemp&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">65</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">MotorCADTwinModel</span></code> object, passing as arguments the path to the input .mot file as
well as the directory to which the results should be saved.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">MotorCADTwin</span> <span class="o">=</span> <span class="n">MotorCADTwinModel</span><span class="p">(</span><a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">inputMotFilePath</span></a><span class="p">,</span> <a href="https://docs.python.org/dev/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">outputDir</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Motor-CAD input file: C:\actions_runner_docs\_work\pymotorcad\pymotorcad\examples\links\e8_mobility.mot
TB data output dir: C:\actions_runner_docs\_work\pymotorcad\pymotorcad\examples\links\thermal_twinbuilder_e8_mobility
</pre></div>
</div>
<p>Finally, generate the required data. This function will write the data to the directory
specified above. The identified cooling system node flow path is automatically plotted.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">MotorCADTwin</span><span class="o">.</span><span class="n">generateTwinData</span><span class="p">(</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rpm&quot;</span><span class="p">:</span> <a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rpms</span></a><span class="p">},</span>
    <span class="n">housingAmbientTemperatures</span><span class="o">=</span><a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">housingAmbientTemps</span></a><span class="p">,</span>
    <span class="n">airgapTemperatures</span><span class="o">=</span><a href="https://docs.python.org/dev/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">airgapTemps</span></a><span class="p">,</span>
    <a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coolingSystemsInputs</span></a><span class="o">=</span><a href="https://docs.python.org/dev/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coolingSystemsInputs</span></a><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_thermal_twinbuilder_001.png" srcset="../../_images/sphx_glr_thermal_twinbuilder_001.png" alt="thermal twinbuilder" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>initialization : compute matrices
initialization : identifying cooling systems
initialization : cooling systems found
DoE : computing sample point rpm = 200
DoE : computing sample point rpm = 500
DoE : computing sample point rpm = 1000
power distribution 1/24 : Armature_Copper_dc
power distribution 2/24 : Armature_Copper_Freq_Comp
power distribution 3/24 : Main_Winding
power distribution 4/24 : Aux_Winding
power distribution 5/24 : Stator_Back_Iron
power distribution 6/24 : Stator_Tooth
power distribution 7/24 : Windage
power distribution 8/24 : Windage_Ext_Fan
power distribution 9/24 : Friction_F_Bearing
power distribution 10/24 : Friction_R_Bearing
power distribution 11/24 : Magnet
power distribution 12/24 : Rotor_Banding
power distribution 13/24 : Stator_Sleeve
power distribution 14/24 : Embedded_Magnet_Pole
power distribution 15/24 : Encoder
power distribution 16/24 : Rotor_Back_Iron
power distribution 17/24 : Rotor_Tooth
power distribution 18/24 : Rotor_Copper
power distribution 19/24 : Stray_Load_Stator_Iron
power distribution 20/24 : Stray_Load_Rotor_Iron
power distribution 21/24 : Stray_Load_Stator_Copper
power distribution 22/24 : Stray_Load_Rotor_Copper
power distribution 23/24 : Brush_Friction
power distribution 24/24 : Brush_VI
Tamb: 20
HousingTemp: 20
HousingTemp: 20.5
HousingTemp: 21.0
HousingTemp: 21.5
HousingTemp: 22.0
HousingTemp: 22.5
HousingTemp: 23.0
HousingTemp: 23.5
HousingTemp: 24.0
HousingTemp: 24.5
HousingTemp: 25.0
HousingTemp: 26.0
HousingTemp: 27.0
HousingTemp: 28.0
HousingTemp: 29.0
HousingTemp: 30.0
HousingTemp: 31.0
HousingTemp: 32.0
HousingTemp: 33.0
HousingTemp: 34.0
HousingTemp: 35.0
HousingTemp: 40.0
HousingTemp: 45.0
HousingTemp: 50.0
HousingTemp: 55.0
HousingTemp: 60.0
HousingTemp: 70.0
HousingTemp: 80.0
HousingTemp: 90.0
HousingTemp: 100.0
Tamb: 40
HousingTemp: 20
HousingTemp: 25
HousingTemp: 30
HousingTemp: 31
HousingTemp: 32
HousingTemp: 33
HousingTemp: 34
HousingTemp: 35
HousingTemp: 36
HousingTemp: 36.5
HousingTemp: 37.0
HousingTemp: 37.5
HousingTemp: 38.0
HousingTemp: 38.5
HousingTemp: 39.0
HousingTemp: 39.5
HousingTemp: 40.0
HousingTemp: 40.5
HousingTemp: 41.0
HousingTemp: 41.5
HousingTemp: 42.0
HousingTemp: 42.5
HousingTemp: 43.0
HousingTemp: 43.5
HousingTemp: 44.0
HousingTemp: 44.5
HousingTemp: 45.0
HousingTemp: 46.0
HousingTemp: 47.0
HousingTemp: 48.0
HousingTemp: 49.0
HousingTemp: 50.0
HousingTemp: 51.0
HousingTemp: 52.0
HousingTemp: 53.0
HousingTemp: 54.0
HousingTemp: 55.0
HousingTemp: 60.0
HousingTemp: 65.0
HousingTemp: 70.0
HousingTemp: 75.0
HousingTemp: 80.0
HousingTemp: 90.0
HousingTemp: 100.0
RPM : 200
Air Gap average temperature: 40
Air Gap average temperature: 50
Air Gap average temperature: 65
RPM : 500
Air Gap average temperature: 40
Air Gap average temperature: 50
Air Gap average temperature: 65
RPM : 1000
Air Gap average temperature: 40
Air Gap average temperature: 50
Air Gap average temperature: 65
Run DP 1/30 for cooling system Housing Water Jacket at parameters values flow rate 9.7695e-05, inlet temperature 40 and rpm 200
Run DP 2/30 for cooling system Housing Water Jacket at parameters values flow rate 9.7695e-05, inlet temperature 40 and rpm 500
Run DP 3/30 for cooling system Housing Water Jacket at parameters values flow rate 9.7695e-05, inlet temperature 40 and rpm 1000
Run DP 4/30 for cooling system Housing Water Jacket at parameters values flow rate 9.7695e-05, inlet temperature 65 and rpm 200
Run DP 5/30 for cooling system Housing Water Jacket at parameters values flow rate 9.7695e-05, inlet temperature 65 and rpm 500
Run DP 6/30 for cooling system Housing Water Jacket at parameters values flow rate 9.7695e-05, inlet temperature 65 and rpm 1000
Run DP 7/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000103122499999999, inlet temperature 40 and rpm 200
Run DP 8/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000103122499999999, inlet temperature 40 and rpm 500
Run DP 9/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000103122499999999, inlet temperature 40 and rpm 1000
Run DP 10/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000103122499999999, inlet temperature 65 and rpm 200
Run DP 11/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000103122499999999, inlet temperature 65 and rpm 500
Run DP 12/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000103122499999999, inlet temperature 65 and rpm 1000
Run DP 13/30 for cooling system Housing Water Jacket at parameters values flow rate 0.00010855, inlet temperature 40 and rpm 200
Run DP 14/30 for cooling system Housing Water Jacket at parameters values flow rate 0.00010855, inlet temperature 40 and rpm 500
Run DP 15/30 for cooling system Housing Water Jacket at parameters values flow rate 0.00010855, inlet temperature 40 and rpm 1000
Run DP 16/30 for cooling system Housing Water Jacket at parameters values flow rate 0.00010855, inlet temperature 65 and rpm 200
Run DP 17/30 for cooling system Housing Water Jacket at parameters values flow rate 0.00010855, inlet temperature 65 and rpm 500
Run DP 18/30 for cooling system Housing Water Jacket at parameters values flow rate 0.00010855, inlet temperature 65 and rpm 1000
Run DP 19/30 for cooling system Housing Water Jacket at parameters values flow rate 0.0001139775, inlet temperature 40 and rpm 200
Run DP 20/30 for cooling system Housing Water Jacket at parameters values flow rate 0.0001139775, inlet temperature 40 and rpm 500
Run DP 21/30 for cooling system Housing Water Jacket at parameters values flow rate 0.0001139775, inlet temperature 40 and rpm 1000
Run DP 22/30 for cooling system Housing Water Jacket at parameters values flow rate 0.0001139775, inlet temperature 65 and rpm 200
Run DP 23/30 for cooling system Housing Water Jacket at parameters values flow rate 0.0001139775, inlet temperature 65 and rpm 500
Run DP 24/30 for cooling system Housing Water Jacket at parameters values flow rate 0.0001139775, inlet temperature 65 and rpm 1000
Run DP 25/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000119405, inlet temperature 40 and rpm 200
Run DP 26/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000119405, inlet temperature 40 and rpm 500
Run DP 27/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000119405, inlet temperature 40 and rpm 1000
Run DP 28/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000119405, inlet temperature 65 and rpm 200
Run DP 29/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000119405, inlet temperature 65 and rpm 500
Run DP 30/30 for cooling system Housing Water Jacket at parameters values flow rate 0.000119405, inlet temperature 65 and rpm 1000
</pre></div>
</div>
</section>
<section id="generating-the-motor-cad-rom-component">
<h2>Generating the <em>Motor-CAD ROM</em> component<a class="headerlink" href="#generating-the-motor-cad-rom-component" title="Link to this heading">#</a></h2>
<p>To generate the component, within Ansys Electronics Desktop, go to the menu bar and select <strong>Twin
Builder</strong> &gt; <strong>Add Component</strong> &gt; <strong>Add Motor-CAD ROM Component…</strong>. Under <strong>Input Files</strong>, press
the <code class="docutils literal notranslate"><span class="pre">...</span></code> icon and choose the <code class="docutils literal notranslate"><span class="pre">outputDir</span></code> as specified in the previous step. Then press the
<strong>Generate</strong> button.</p>
<img alt="../../_images/Thermal_Twinbuilder_GenerateROM_Filled.png" src="../../_images/Thermal_Twinbuilder_GenerateROM_Filled.png" />
<p>Should the generation be successful, the <strong>Log</strong> will indicate that the SML model has been written
and the <strong>Select Interfaces</strong> table will be populated.</p>
<p>The resulting <em>Motor-CAD ROM</em> component will then be available to use.</p>
<img alt="../../_images/Thermal_Twinbuilder_TwinBuilderROM.png" src="../../_images/Thermal_Twinbuilder_TwinBuilderROM.png" />
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For informtation on how to use the <em>Motor-CAD ROM</em> component, please consult the
Twin Builder Help Manual.</p>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (13 minutes 16.742 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-links-thermal-twinbuilder-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/56dea66c848a87982c9e16b462f6681d/thermal_twinbuilder.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">thermal_twinbuilder.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/692b9ba0d6f6efe7a69e48696e2d663b/thermal_twinbuilder.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">thermal_twinbuilder.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/80c1441e28504f86baa677701882748e/thermal_twinbuilder.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">thermal_twinbuilder.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-required-to-generate-a-motor-cad-rom-component">Data required to generate a <em>Motor-CAD ROM</em> component</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-required-imports">Perform required imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-required-class">Define the required Class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-use-case">Example use case</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-the-motor-cad-rom-component">Generating the <em>Motor-CAD ROM</em> component</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
<!-- If there is no fix edit button function, use the PyData edit-this-button-->
</div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <ul class="this-page-menu">
      <li><a href="../../_sources/examples/links/thermal_twinbuilder.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>


  <!-- Include desired assets -->
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.7/require.min.js"></script>

<script>
// Passing the search options to the search.js file
const SEARCH_OPTIONS = JSON.parse('{"keys": ["title", "text"], "limit": 10, "threshold": 0.2}');
const SEARCH_FILE = "../../_static/search.json";
</script>


<script src="../../_static/js/search.js"></script>
  
  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright (c) 2025 ANSYS, Inc. All rights reserved.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the
  <a href="https://sphinxdocs.ansys.com/version/stable/index.html"
    >Ansys Sphinx Theme</a
  >
  1.3.3. <br />Last updated on
  <span id="ast_build_date"></span>
</p>
<script>
  var options = { day: "numeric", month: "long", year: "numeric" };
  var ast_lastModifiedDate = new Date(document.lastModified);
  var ast_build_date = ast_lastModifiedDate.toLocaleDateString("en-US", options);
  document.getElementById("ast_build_date").innerHTML = ast_build_date;
</script></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>